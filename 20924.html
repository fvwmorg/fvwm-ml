<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
<meta name="generator" content="hypermail 2.3.0, see http://www.hypermail-project.org/" />
<title>Re: PATCHES (Re: FVWM: Menu editing commands) from Konrad Schroder on 1997-09-08 (fvwm-users)</title>
<meta name="Author" content="Konrad Schroder (perseant_at_hitl.washington.edu)" />
<meta name="Subject" content="Re: PATCHES (Re: FVWM: Menu editing commands)" />
<meta name="Date" content="1997-09-08" />
<style type="text/css">
/*<![CDATA[*/
/* To be incorporated in the main stylesheet, don't code it in hypermail! */
body {color: black; background: #ffffff}
dfn {font-weight: bold;}
pre { background-color:inherit;}
.head { border-bottom:1px solid black;}
.foot { border-top:1px solid black;}
th {font-style:italic;}
table { margin-left:2em;}map ul {list-style:none;}
#mid { font-size:0.9em;}
#received { float:right;}
address { font-style:inherit ;}
/*]]>*/
.quotelev1 {color : #990099}
.quotelev2 {color : #ff7700}
.quotelev3 {color : #007799}
.quotelev4 {color : #95c500}
.period {font-weight: bold}
</style>
</head>
<body>
<div class="head">
<h1>Re: PATCHES (Re: FVWM: Menu editing commands)</h1>
<!-- received="Mon Sep  8 11:52:53 1997" -->
<!-- isoreceived="19970908105253" -->
<!-- sent="Mon, 8 Sep 1997 09:51:52 -0700 (PDT)" -->
<!-- isosent="19970908165152" -->
<!-- name="Konrad Schroder" -->
<!-- email="perseant_at_hitl.washington.edu" -->
<!-- subject="Re: PATCHES (Re: FVWM: Menu editing commands)" -->
<!-- id="Pine.OSF.3.95.970908094943.12744B-200000_at_stout.hitl.washington.edu" -->
<!-- charset="US-ASCII" -->
<!-- inreplyto="34112DCB.EF6486F1_at_rhein-neckar.netsurf.de" -->
<!-- expires="-1" -->
<map id="navbar" name="navbar">
<ul class="links">
<li>
<dfn>This message</dfn>:
[ <a href="#start20924" name="options1" id="options1" tabindex="1">Message body</a> ]
 [ More options (<a href="#options2">top</a>, <a href="#options3">bottom</a>) ]
</li>
<li>
<dfn>Related messages</dfn>:
<!-- unext="start" -->
[ <a href="20925.html" accesskey="d" title="Michael M Han: &quot;FVWM: Makefile help for AIX&quot;">Next message</a> ]
[ <a href="20923.html" title="Kai Grossjohann: &quot;Re: PATCHES (Re: FVWM: Menu editing commands)&quot;">Previous message</a> ]
[ <a href="20913.html" title="Adam Kopacz: &quot;PATCHES (Re: FVWM: Menu editing commands)&quot;">In reply to</a> ]
<!-- unextthread="start" -->
<!-- ureply="end" -->
</li>
</ul>
</map>
<ul class="links">
<li><a name="options2" id="options2"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="date.html#msg20924" title="Contemporary messages by date">by date</a> ] [ <a href="index.html#msg20924" title="Contemporary discussion threads">by thread</a> ] [ <a href="subject.html#msg20924" title="Contemporary messages by subject">by subject</a> ] [ <a href="author.html#msg20924" title="Contemporary messages by author">by author</a> ] [ <a href="attachment.html" title="Contemporary messages by attachment">by messages with attachments</a> ]</li>
</ul>
</div>
<!-- body="start" -->
<div class="mail">
<address class="headers">
<span id="from">
<dfn>From</dfn>: Konrad Schroder &lt;<a href="mailto:perseant_at_hitl.washington.edu?Subject=Re%3A%20PATCHES%20(Re%3A%20FVWM%3A%20Menu%20editing%20commands)">perseant_at_hitl.washington.edu</a>&gt;
</span><br />
<span id="date"><dfn>Date</dfn>: Mon, 8 Sep 1997 09:51:52 -0700 (PDT)</span><br />
</address>
<br />
On Sat, 6 Sep 1997, Adam Kopacz wrote:
<br />
<br />[...]
<br />
<em class="quotelev1">&gt; please STOP posting patches INLINE in a message! nobody can use this
</em><br />
<br />Well, for the benefit of anyone who couldn't (for whatever reason), here
<br />
it is again, MIME-encoded.
<br />
<br />-------------------------------------------------------------------------
<br />
Konrad Schroder           <a href="http://www.hitl.washington.edu/people/perseant/">http://www.hitl.washington.edu/people/perseant/</a>
<br />
System Administrator                         perseant_at_hitl.washington.edu
<br />
Human Interface Technology Lab                      Voice: (206) 616-1478
<br />
Box 352142, University of Washington, 98195, USA      FAX: (206) 543-5380
<br />
<br /><br />
*** fvwm/builtins.c.dist	Wed Jan 22 05:37:28 1997
<br />
--- fvwm/builtins.c	Fri Sep 05 14:09:14 1997
<br />
***************
<br />
*** 468,471 ****
<br />
--- 468,570 ----
<br />
&nbsp;&nbsp;#endif
<br />
&nbsp;&nbsp;char *last_menu = NULL;
<br />
+ char *last_menu_arg = NULL;
<br />
+ int last_menu_flag = MA_NORMAL;
<br />
+ 
<br />
+ 
<br />
+ void delete_item_from_menu(XEvent *eventp, Window w, FvwmWindow *tmp_win,
<br />
+                           unsigned long context, char *action, int *Module)
<br />
+ {
<br />
+   MenuRoot *mr;
<br />
+ 
<br />
+   char *token, *rest,*item;
<br />
+   char *flag, *arg;
<br />
+ 
<br />
+ #ifdef USEDECOR
<br />
+   last_decor = NULL;
<br />
+ #endif
<br />
+   if(last_menu != NULL)
<br />
+     free(last_menu);
<br />
+   last_menu = NULL;
<br />
+ 
<br />
+   rest = GetNextToken(action,&amp;token);
<br />
+   mr = FindPopup(token);
<br />
+   rest = GetNextToken(rest,&amp;item);
<br />
+ 
<br />
+   if(mr)
<br />
+   {
<br />
+       DeleteFromMenu(mr,item);
<br />
+       MakeMenu(mr);
<br />
+   }
<br />
+   free(item);
<br />
+ }
<br />
+ 
<br />
+ /* This is the same as below, but controls placement too */
<br />
+ void add_item_above_in_menu(XEvent *eventp, Window w, FvwmWindow *tmp_win,
<br />
+                           unsigned long context, char *action, int *Module)
<br />
+ {
<br />
+   MenuRoot *mr;
<br />
+ 
<br />
+   char *token, *rest,*item;
<br />
+   char *flag, *arg;
<br />
+ 
<br />
+ #ifdef USEDECOR
<br />
+   last_decor = NULL;
<br />
+ #endif
<br />
+ 
<br />
+   rest = GetNextToken(action,&amp;token);
<br />
+   mr = FindPopup(token);
<br />
+   if(mr == NULL)
<br />
+     mr = NewMenuRoot(token, 0);
<br />
+   if(last_menu != NULL)
<br />
+     free(last_menu);
<br />
+   last_menu = token;
<br />
+ 
<br />
+   rest = GetNextToken(rest,&amp;arg);   /* the reference item */
<br />
+ 
<br />
+   rest = GetNextToken(rest,&amp;item);  /* now the new item */
<br />
+ 
<br />
+   last_menu_arg  = arg;
<br />
+   last_menu_flag = MA_ABOVE;
<br />
+ 
<br />
+   AddToMenu(mr, item, rest, MA_ABOVE, arg);
<br />
+   free(item);
<br />
+   
<br />
+   MakeMenu(mr);
<br />
+   return;
<br />
+ }
<br />
+ 
<br />
+ void replace_item_in_menu(XEvent *eventp,Window w,FvwmWindow *tmp_win,
<br />
+ 		      unsigned long context,
<br />
+ 		      char *action, int *Module)
<br />
+ {
<br />
+   MenuRoot *mr;
<br />
+ 
<br />
+   char *token, *rest,*item;
<br />
+   char *flag, *arg;
<br />
+ 
<br />
+ #ifdef USEDECOR
<br />
+   last_decor = NULL;
<br />
+ #endif
<br />
+   last_menu = NULL;
<br />
+   last_menu_arg  = NULL;
<br />
+   last_menu_flag = MA_NORMAL;
<br />
+ 
<br />
+   rest = GetNextToken(action,&amp;token);
<br />
+   mr = FindPopup(token);
<br />
+   if(mr == NULL)
<br />
+     mr = NewMenuRoot(token, 0);
<br />
+   if(last_menu != NULL)
<br />
+     free(last_menu);
<br />
+ 
<br />
+   rest = GetNextToken(rest,&amp;arg);   /* the reference item */
<br />
+   rest = GetNextToken(rest,&amp;item);  /* now the new item */
<br />
+ 
<br />
+   AddToMenu(mr, item, rest, MA_REPLACE, arg);
<br />
+   free(item);
<br />
+   
<br />
+   MakeMenu(mr);
<br />
+   return;
<br />
+ }
<br />
+ 
<br />
&nbsp;&nbsp;void add_item_to_menu(XEvent *eventp,Window w,FvwmWindow *tmp_win,
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned long context,
<br />
***************
<br />
*** 475,478 ****
<br />
--- 574,579 ----
<br />
&nbsp;&nbsp;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;char *token, *rest,*item;
<br />
+   char *flag, *arg;
<br />
+   int i_flag = MA_NORMAL, i;
<br />
&nbsp;&nbsp;
<br />
&nbsp;&nbsp;#ifdef USEDECOR
<br />
***************
<br />
*** 487,493 ****
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(last_menu);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;last_menu = token;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;rest = GetNextToken(rest,&amp;item);
<br />
&nbsp;&nbsp;
<br />
!   AddToMenu(mr, item,rest);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;free(item);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;
<br />
--- 588,597 ----
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(last_menu);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;last_menu = token;
<br />
+   last_menu_arg  = NULL;
<br />
+   last_menu_flag = MA_NORMAL;
<br />
+ 
<br />
&nbsp;&nbsp;&nbsp;&nbsp;rest = GetNextToken(rest,&amp;item);
<br />
&nbsp;&nbsp;
<br />
!   AddToMenu(mr, item, rest, MA_NORMAL, NULL);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;free(item);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;
<br />
***************
<br />
*** 517,521 ****
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rest = GetNextToken(action,&amp;item);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br />
!       AddToMenu(mr, item,rest);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(item);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br />
--- 621,625 ----
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rest = GetNextToken(action,&amp;item);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br />
!       AddToMenu(mr, item, rest, last_menu_flag, last_menu_arg);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(item);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br />
***************
<br />
*** 549,553 ****
<br />
&nbsp;&nbsp;&nbsp;&nbsp;rest = GetNextToken(action,&amp;item);
<br />
&nbsp;&nbsp;
<br />
!   AddToMenu(mr, item,rest);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;free(item);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;
<br />
--- 653,657 ----
<br />
&nbsp;&nbsp;&nbsp;&nbsp;rest = GetNextToken(action,&amp;item);
<br />
&nbsp;&nbsp;
<br />
!   AddToMenu(mr, item, rest, last_menu_flag, last_menu_arg);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;free(item);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;
<br />
***************
<br />
*** 591,595 ****
<br />
&nbsp;&nbsp;&nbsp;&nbsp;rest = GetNextToken(rest,&amp;item);
<br />
&nbsp;&nbsp;
<br />
!   AddToMenu(mr, item,rest);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;free(item);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;
<br />
--- 695,699 ----
<br />
&nbsp;&nbsp;&nbsp;&nbsp;rest = GetNextToken(rest,&amp;item);
<br />
&nbsp;&nbsp;
<br />
!   AddToMenu(mr, item, rest, MA_NORMAL, NULL);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;free(item);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;
<br />
*** fvwm/functions.c.dist	Fri Sep 05 13:16:50 1997
<br />
--- fvwm/functions.c	Fri Sep 05 14:15:08 1997
<br />
***************
<br />
*** 36,39 ****
<br />
--- 36,40 ----
<br />
&nbsp;&nbsp;struct functions func_config[] =
<br />
&nbsp;&nbsp;{
<br />
+   {&quot;AddAboveInMenu&quot;,add_item_above_in_menu, F_ADDMENU_ABOVE, FUNC_NO_WINDOW},
<br />
&nbsp;&nbsp;#ifdef MULTISTYLE
<br />
&nbsp;&nbsp;&nbsp;&nbsp;{&quot;AddButtonStyle&quot;,AddButtonStyle,  F_ADD_BUTTON_STYLE,    FUNC_NO_WINDOW},
<br />
***************
<br />
*** 68,71 ****
<br />
--- 69,73 ----
<br />
&nbsp;&nbsp;#endif
<br />
&nbsp;&nbsp;&nbsp;&nbsp;{&quot;DestroyFunc&quot;,  destroy_menu,     F_DESTROY_MENU,        FUNC_NO_WINDOW},
<br />
+   {&quot;DestroyMenuItem&quot;, delete_item_from_menu, F_DELMITEM,    FUNC_NO_WINDOW},
<br />
&nbsp;&nbsp;&nbsp;&nbsp;{&quot;DestroyMenu&quot;,  destroy_menu,     F_DESTROY_MENU,        FUNC_NO_WINDOW},
<br />
&nbsp;&nbsp;&nbsp;&nbsp;{&quot;DestroyModuleConfig&quot;, DestroyModConfig, F_DESTROY_MOD,  FUNC_NO_WINDOW},
<br />
***************
<br />
*** 112,115 ****
<br />
--- 114,118 ----
<br />
&nbsp;&nbsp;&nbsp;&nbsp;{&quot;Refresh&quot;,      refresh_function, F_REFRESH,             FUNC_NO_WINDOW},
<br />
&nbsp;&nbsp;&nbsp;&nbsp;{&quot;RefreshWindow&quot;,refresh_win_function, F_REFRESH,         FUNC_NEEDS_WINDOW},
<br />
+   {&quot;ReplaceInMenu&quot;,replace_item_in_menu, F_REPLACEMENU,     FUNC_NO_WINDOW},
<br />
&nbsp;&nbsp;&nbsp;&nbsp;{&quot;Resize&quot;,       resize_window,    F_RESIZE,              FUNC_NEEDS_WINDOW},
<br />
&nbsp;&nbsp;&nbsp;&nbsp;{&quot;Restart&quot;,      restart_function, F_RESTART,             FUNC_NO_WINDOW},
<br />
*** fvwm/menus.c.dist	Thu Sep 04 12:08:52 1997
<br />
--- fvwm/menus.c	Fri Sep 05 13:02:24 1997
<br />
***************
<br />
*** 876,880 ****
<br />
--- 876,893 ----
<br />
&nbsp;&nbsp;
<br />
&nbsp;&nbsp;
<br />
+ MenuItem *DestroyMenuItem(MenuItem *mi)
<br />
+ {
<br />
+     MenuItem *tmp2 = mi-&gt;next;
<br />
&nbsp;&nbsp;
<br />
+       if (mi-&gt;item != NULL) free(mi-&gt;item);
<br />
+       if (mi-&gt;item2 != NULL) free(mi-&gt;item2);
<br />
+       if (mi-&gt;action != NULL) free(mi-&gt;action);
<br />
+       if(mi-&gt;picture)
<br />
+ 	DestroyPicture(dpy,mi-&gt;picture);
<br />
+       if(mi-&gt;lpicture)
<br />
+ 	DestroyPicture(dpy,mi-&gt;lpicture);
<br />
+       free(mi);
<br />
+       return tmp2;
<br />
+ }
<br />
&nbsp;&nbsp;
<br />
&nbsp;&nbsp;void DestroyMenu(MenuRoot *mr)
<br />
***************
<br />
*** 908,921 ****
<br />
&nbsp;&nbsp;&nbsp;&nbsp;while(mi != NULL)
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
<br />
!       tmp2 = mi-&gt;next;
<br />
!       if (mi-&gt;item != NULL) free(mi-&gt;item);
<br />
!       if (mi-&gt;item2 != NULL) free(mi-&gt;item2);
<br />
!       if (mi-&gt;action != NULL) free(mi-&gt;action);
<br />
!       if(mi-&gt;picture)
<br />
! 	DestroyPicture(dpy,mi-&gt;picture);
<br />
!       if(mi-&gt;lpicture)
<br />
! 	DestroyPicture(dpy,mi-&gt;lpicture);
<br />
!       free(mi);
<br />
!       mi = tmp2;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
<br />
&nbsp;&nbsp;&nbsp;&nbsp;free(mr);
<br />
--- 921,925 ----
<br />
&nbsp;&nbsp;&nbsp;&nbsp;while(mi != NULL)
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
<br />
!         mi = DestroyMenuItem(mi);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
<br />
&nbsp;&nbsp;&nbsp;&nbsp;free(mr);
<br />
***************
<br />
*** 1167,1171 ****
<br />
--- 1171,1252 ----
<br />
&nbsp;&nbsp;
<br />
&nbsp;&nbsp;
<br />
+ /*
<br />
+  * GetReferenceMenuItem - get a reference menu item to delete, or add after.
<br />
+  */
<br />
&nbsp;&nbsp;
<br />
+ MenuItem *GetReferenceMenuItem(MenuRoot *menu, char *ref)
<br />
+ {
<br />
+     MenuItem *mi_ref;
<br />
+ 
<br />
+     if(ref==NULL || ref[0]=='\0')
<br />
+         mi_ref = menu-&gt;first;
<br />
+     else
<br />
+     {
<br />
+         if(menu-&gt;first == NULL)
<br />
+             mi_ref = NULL;
<br />
+         else
<br />
+         {
<br />
+             for(mi_ref=menu-&gt;first; mi_ref; mi_ref = mi_ref-&gt;next)
<br />
+             {
<br />
+                 if(mi_ref-&gt;item &amp;&amp; strcasecmp(mi_ref-&gt;item,ref)==0)
<br />
+                     break;
<br />
+             }
<br />
+             if(mi_ref==NULL)
<br />
+             {
<br />
+                 /* try again with item2 */
<br />
+                 for(mi_ref=menu-&gt;first; mi_ref; mi_ref = mi_ref-&gt;next)
<br />
+                 {
<br />
+                     if(mi_ref-&gt;item2 &amp;&amp; strcasecmp(mi_ref-&gt;item2,ref)==0)
<br />
+                         break;
<br />
+                 }
<br />
+             }
<br />
+             if(mi_ref==NULL)
<br />
+             {
<br />
+                 /* now we're desperate...try partial matches */
<br />
+                 for(mi_ref=menu-&gt;first; mi_ref; mi_ref = mi_ref-&gt;next)
<br />
+                 {
<br />
+                     if((mi_ref-&gt;item
<br />
+                         &amp;&amp; strncasecmp(mi_ref-&gt;item,ref,strlen(ref))==0)
<br />
+                        || (mi_ref-&gt;item2
<br />
+                            &amp;&amp; strncasecmp(mi_ref-&gt;item2,ref,strlen(ref))==0))
<br />
+                         break;
<br />
+                 }
<br />
+             }
<br />
+         }
<br />
+     }
<br />
+     return mi_ref;
<br />
+ }
<br />
+ 
<br />
+ /*
<br />
+  * DeleteFromMenu - delete an item from a menu
<br />
+  */
<br />
+ 
<br />
+ void DeleteFromMenu(MenuRoot *menu, char *item)
<br />
+ {
<br />
+     MenuItem *delenda, *t;
<br />
+ 
<br />
+     delenda = GetReferenceMenuItem(menu,item);
<br />
+     if(delenda)
<br />
+     {
<br />
+         /* detach */
<br />
+         if(delenda-&gt;prev)
<br />
+             delenda-&gt;prev-&gt;next = delenda-&gt;next;
<br />
+         else
<br />
+             menu-&gt;first = delenda-&gt;next;
<br />
+         if(delenda-&gt;next)
<br />
+             delenda-&gt;next-&gt;prev = delenda-&gt;prev;
<br />
+         else
<br />
+             menu-&gt;last = delenda-&gt;prev;
<br />
+ 
<br />
+         /* destroy */
<br />
+         DestroyMenuItem(delenda);
<br />
+ 
<br />
+         /* clean up numbering */
<br />
+         menu-&gt;items=0;
<br />
+         for(t=menu-&gt;first; t; t=t-&gt;next)
<br />
+             t-&gt;item_num = menu-&gt;items++;
<br />
+     }
<br />
+ }
<br />
+ 
<br />
&nbsp;&nbsp;/***********************************************************************
<br />
&nbsp;&nbsp;&nbsp;*
<br />
***************
<br />
*** 1181,1184 ****
<br />
--- 1262,1267 ----
<br />
&nbsp;&nbsp;&nbsp;*	action	- the string to possibly execute
<br />
&nbsp;&nbsp;&nbsp;*	func	- the numeric function
<br />
+  * (ks) how     - additional flags to control placement
<br />
+  * (ks) ref     - menu item relative to which placement is done
<br />
&nbsp;&nbsp;&nbsp;*
<br />
&nbsp;&nbsp;&nbsp;* ckh - need to add boolean to say whether or not to expand for pixmaps,
<br />
***************
<br />
*** 1186,1193 ****
<br />
&nbsp;&nbsp;&nbsp;*
<br />
&nbsp;&nbsp;&nbsp;***********************************************************************/
<br />
! void AddToMenu(MenuRoot *menu, char *item, char *action)
<br />
&nbsp;&nbsp;{
<br />
!   MenuItem *tmp;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;char *start,*end;
<br />
&nbsp;&nbsp;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;if(item == NULL)
<br />
--- 1269,1277 ----
<br />
&nbsp;&nbsp;&nbsp;*
<br />
&nbsp;&nbsp;&nbsp;***********************************************************************/
<br />
! void AddToMenu(MenuRoot *menu, char *item, char *action, int how, char *ref)
<br />
&nbsp;&nbsp;{
<br />
!   MenuItem *tmp, *mi_ref, *t;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;char *start,*end;
<br />
+   int i;
<br />
&nbsp;&nbsp;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;if(item == NULL)
<br />
***************
<br />
*** 1195,1209 ****
<br />
&nbsp;&nbsp;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;tmp = (MenuItem *)safemalloc(sizeof(MenuItem));
<br />
!   if (menu-&gt;first == NULL)
<br />
!     {
<br />
!       menu-&gt;first = tmp;
<br />
!       tmp-&gt;prev = NULL;
<br />
!     }
<br />
!   else
<br />
!     {
<br />
!       menu-&gt;last-&gt;next = tmp;
<br />
!       tmp-&gt;prev = menu-&gt;last;
<br />
!     }
<br />
!   menu-&gt;last = tmp;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;tmp-&gt;picture=NULL;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;tmp-&gt;lpicture=NULL;
<br />
--- 1279,1337 ----
<br />
&nbsp;&nbsp;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;tmp = (MenuItem *)safemalloc(sizeof(MenuItem));
<br />
! 
<br />
!   /* If we need a reference, get one here.  NULL means none was available */
<br />
!   if(how!=MA_NORMAL)
<br />
!   {
<br />
!       mi_ref = GetReferenceMenuItem(menu,ref);
<br />
!   }
<br />
! 
<br />
!   switch(how)
<br />
!   {
<br />
!       /* all of these cases fall through to the standard case, if  */
<br />
!       /* no reference menu item could be found */
<br />
!   case MA_REPLACE:
<br />
!       if(mi_ref)
<br />
!       {
<br />
!           tmp-&gt;prev = mi_ref-&gt;prev;
<br />
!           tmp-&gt;next = mi_ref-&gt;next;
<br />
!           if(tmp-&gt;prev)
<br />
!               tmp-&gt;prev-&gt;next = tmp;
<br />
!           else
<br />
!               menu-&gt;first = tmp;
<br />
!           if(tmp-&gt;next)
<br />
!               tmp-&gt;next-&gt;prev = tmp;
<br />
!           else
<br />
!               menu-&gt;last = tmp;
<br />
!           DestroyMenuItem(mi_ref);
<br />
!           break;
<br />
!       }
<br />
!   case MA_ABOVE:
<br />
!       if(mi_ref)
<br />
!       {
<br />
!           tmp-&gt;next = mi_ref;
<br />
!           tmp-&gt;prev = mi_ref-&gt;prev;
<br />
!           mi_ref-&gt;prev = tmp;
<br />
!           if(tmp-&gt;prev)
<br />
!               tmp-&gt;prev-&gt;next = tmp;
<br />
!           else
<br />
!               menu-&gt;first = tmp;
<br />
!           break;
<br />
!       }
<br />
!   case MA_NORMAL:
<br />
!   default:
<br />
!       if (menu-&gt;first == NULL)
<br />
!       {
<br />
!           menu-&gt;first = tmp;
<br />
!           tmp-&gt;prev = NULL;
<br />
!       }
<br />
!       else
<br />
!       {
<br />
!           menu-&gt;last-&gt;next = tmp;
<br />
!           tmp-&gt;prev = menu-&gt;last;
<br />
!       }
<br />
!       menu-&gt;last = tmp;
<br />
!       break;
<br />
!   }
<br />
! 
<br />
&nbsp;&nbsp;&nbsp;&nbsp;tmp-&gt;picture=NULL;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;tmp-&gt;lpicture=NULL;
<br />
***************
<br />
*** 1258,1265 ****
<br />
&nbsp;&nbsp;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;tmp-&gt;action = stripcpy(action);
<br />
-   tmp-&gt;next = NULL;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;tmp-&gt;state = 0;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;tmp-&gt;func_type = find_func_type(tmp-&gt;action);
<br />
!   tmp-&gt;item_num = menu-&gt;items++;
<br />
&nbsp;&nbsp;}
<br />
&nbsp;&nbsp;
<br />
--- 1386,1401 ----
<br />
&nbsp;&nbsp;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;tmp-&gt;action = stripcpy(action);
<br />
&nbsp;&nbsp;&nbsp;&nbsp;tmp-&gt;state = 0;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;tmp-&gt;func_type = find_func_type(tmp-&gt;action);
<br />
!   if(how == MA_NORMAL)
<br />
!   {
<br />
!       tmp-&gt;next = NULL;
<br />
!       tmp-&gt;item_num = menu-&gt;items++;
<br />
!   }
<br />
!   else
<br />
!       for(menu-&gt;items=0, tmp=menu-&gt;first; tmp; tmp=tmp-&gt;next)
<br />
!       {
<br />
!           tmp-&gt;item_num = menu-&gt;items++;
<br />
!       }
<br />
&nbsp;&nbsp;}
<br />
&nbsp;&nbsp;
<br />
*** fvwm/menus.h.dist	Thu Sep 04 12:45:19 1997
<br />
--- fvwm/menus.h	Thu Sep 04 12:47:09 1997
<br />
***************
<br />
*** 54,57 ****
<br />
--- 54,62 ----
<br />
&nbsp;&nbsp;#include &quot;../libs/fvwmlib.h&quot;
<br />
&nbsp;&nbsp;
<br />
+ #define MA_NORMAL 0
<br />
+ #define MA_ABOVE  1
<br />
+ #define MA_BENEATH 2
<br />
+ #define MA_REPLACE 3
<br />
+ 
<br />
&nbsp;&nbsp;typedef struct MenuItem
<br />
&nbsp;&nbsp;{
<br />
*** fvwm/misc.h.dist	Thu Sep 04 13:41:18 1997
<br />
--- fvwm/misc.h	Fri Sep 05 14:17:11 1997
<br />
***************
<br />
*** 224,228 ****
<br />
&nbsp;&nbsp;extern void       UngrabEm(void);
<br />
&nbsp;&nbsp;extern MenuRoot   *NewMenuRoot(char *name, int function_or_popup);
<br />
! extern void       AddToMenu(MenuRoot *, char *, char *);
<br />
&nbsp;&nbsp;extern void       MakeMenu(MenuRoot *);
<br />
&nbsp;&nbsp;extern void       CaptureAllWindows(void);
<br />
--- 224,228 ----
<br />
&nbsp;&nbsp;extern void       UngrabEm(void);
<br />
&nbsp;&nbsp;extern MenuRoot   *NewMenuRoot(char *name, int function_or_popup);
<br />
! extern void       AddToMenu(MenuRoot *, char *, char *, int, char *);
<br />
&nbsp;&nbsp;extern void       MakeMenu(MenuRoot *);
<br />
&nbsp;&nbsp;extern void       CaptureAllWindows(void);
<br />
***************
<br />
*** 468,472 ****
<br />
--- 468,481 ----
<br />
&nbsp;&nbsp;void GetMenuXPMFile(char *name, MenuItem *it);
<br />
&nbsp;&nbsp;void GetMenuBitmapFile(char *name, MenuItem *it);
<br />
+ void delete_item_from_menu(XEvent *eventp,Window w,FvwmWindow *tmp_win,
<br />
+ 		      unsigned long context,
<br />
+ 		      char *action, int *Module);
<br />
+ void add_item_above_in_menu(XEvent *eventp,Window w,FvwmWindow *tmp_win,
<br />
+ 		      unsigned long context,
<br />
+ 		      char *action, int *Module);
<br />
&nbsp;&nbsp;void add_item_to_menu(XEvent *eventp,Window w,FvwmWindow *tmp_win,
<br />
+ 		      unsigned long context,
<br />
+ 		      char *action, int *Module);
<br />
+ void replace_item_in_menu(XEvent *eventp,Window w,FvwmWindow *tmp_win,
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned long context,
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char *action, int *Module);
<br />
*** fvwm/parse.h.dist	Fri Sep 05 13:16:33 1997
<br />
--- fvwm/parse.h	Fri Sep 05 14:06:30 1997
<br />
***************
<br />
*** 74,77 ****
<br />
--- 74,82 ----
<br />
&nbsp;&nbsp;#define F_TITLESTYLE            56
<br />
&nbsp;&nbsp;#define F_EXEC_SETUP            57
<br />
+ 
<br />
+ #define F_ADDMENU_ABOVE         58
<br />
+ #define F_DELMITEM              59
<br />
+ #define F_REPLACEMENU           60
<br />
+ 
<br />
&nbsp;&nbsp;/* Functions which require a target window */
<br />
&nbsp;&nbsp;#define F_RESIZE		100
<br />
*** fvwm/windows.c.dist	Thu Sep 04 13:33:13 1997
<br />
--- fvwm/windows.c	Thu Sep 04 13:34:04 1997
<br />
***************
<br />
*** 135,139 ****
<br />
&nbsp;&nbsp;&nbsp;&nbsp;}
<br />
&nbsp;&nbsp;&nbsp;&nbsp;mr=NewMenuRoot(tlabel,0);
<br />
!   AddToMenu(mr, tlabel, &quot;TITLE&quot;);      
<br />
&nbsp;&nbsp;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;next_desk = 0;
<br />
--- 135,139 ----
<br />
&nbsp;&nbsp;&nbsp;&nbsp;}
<br />
&nbsp;&nbsp;&nbsp;&nbsp;mr=NewMenuRoot(tlabel,0);
<br />
!   AddToMenu(mr, tlabel, &quot;TITLE&quot;, MA_NORMAL, NULL);      
<br />
&nbsp;&nbsp;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;next_desk = 0;
<br />
***************
<br />
*** 227,231 ****
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf(tlabel,&quot;WindowListFunc %ld&quot;,t-&gt;w);
<br />
!         AddToMenu(mr, t_hot, tlabel);
<br />
&nbsp;&nbsp;#ifdef MINI_ICONS
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Add the title pixmap */
<br />
--- 227,231 ----
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf(tlabel,&quot;WindowListFunc %ld&quot;,t-&gt;w);
<br />
!         AddToMenu(mr, t_hot, tlabel, MA_NORMAL, NULL);
<br />
&nbsp;&nbsp;#ifdef MINI_ICONS
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Add the title pixmap */
<br />
<pre>
--
Visit the official FVWM web page at &lt;URL:<a href="http://www.hpc.uh.edu/fvwm/">http://www.hpc.uh.edu/fvwm/</a>&gt;.
To unsubscribe from the list, send &quot;unsubscribe fvwm&quot; in the body of a
message to majordomo_at_hpc.uh.edu.
To report problems, send mail to fvwm-owner_at_hpc.uh.edu.
</pre>
<span id="received"><dfn>Received on</dfn> Mon Sep 08 1997 - 11:52:53 BST</span>
</div>
<!-- body="end" -->
<div class="foot">
<map id="navbarfoot" name="navbarfoot" title="Related messages">
<ul class="links">
<li><dfn>This message</dfn>: [ <a href="#start20924">Message body</a> ]</li>
<!-- lnext="start" -->
<li><dfn>Next message</dfn>: <a href="20925.html" title="Next message in the list">Michael M Han: "FVWM: Makefile help for AIX"</a></li>
<li><dfn>Previous message</dfn>: <a href="20923.html" title="Previous message in the list">Kai Grossjohann: "Re: PATCHES (Re: FVWM: Menu editing commands)"</a></li>
<li><dfn>In reply to</dfn>: <a href="20913.html" title="Message to which this message replies">Adam Kopacz: "PATCHES (Re: FVWM: Menu editing commands)"</a></li>
<!-- lnextthread="start" -->
<!-- lreply="end" -->
</ul>
<ul class="links">
<li><a name="options3" id="options3"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="date.html#msg20924" title="Contemporary messages by date">by date</a> ] [ <a href="index.html#msg20924" title="Contemporary discussion threads">by thread</a> ] [ <a href="subject.html#msg20924" title="Contemporary messages by subject">by subject</a> ] [ <a href="author.html#msg20924" title="Contemporary messages by author">by author</a> ] [ <a href="attachment.html" title="Contemporary messages by attachment">by messages with attachments</a> ]</li>
</ul>
</map>
</div>
<!-- trailer="footer" -->
<p><small><em>
This archive was generated by <a href="http://www.hypermail-project.org/">hypermail 2.3.0</a>
: Mon Aug 29 2016 - 19:38:00 BST
</em></small></p>
</body>
</html>

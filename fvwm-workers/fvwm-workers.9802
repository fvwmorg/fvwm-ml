From owner-fvwm-workers@hpc.uh.edu  Sun Feb  1 23:59:06 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Sun, 01 Feb 1998 23:59:06 -0600 (CST)
Received: from mercury.elmailer.net (mercury.elmailer.net [195.224.76.4]) by sina.hpc.uh.edu (8.7.3/8.7.3) with ESMTP id XAA00716 for <fvwm-workers@hpc.uh.edu>; Sun, 1 Feb 1998 23:58:58 -0600 (CST)
Received: by mercury.elmailer.net with ESMTP
    from sfere.greenend.org.uk (sfere.greenend.org.uk [195.224.38.1])
    id FAA20353 for <fvwm-workers@hpc.uh.edu> (2.4-8.8.8/3.1.31);
    Mon, 2 Feb 1998 05:56:43 GMT
Received: from valour.greenend.org.uk (root@valour.greenend.org.uk [195.224.38.2])
	by sfere.greenend.org.uk (8.8.8/8.8.8) with ESMTP id CAA11707
	for <fvwm-workers@hpc.uh.edu>; Mon, 2 Feb 1998 02:08:05 GMT
Received: by valour.greenend.org.uk
	id m0xzBIr-000w4uC
	(Debian Smail-3.2 1996-Jul-4 #2); Mon, 2 Feb 1998 02:08:05 +0000 (GMT)
Message-Id: <m0xzBIr-000w4uC@valour.greenend.org.uk>
Date: Mon, 2 Feb 1998 02:08:05 +0000 (GMT)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
From: Austin Donnelly <austin@greenend.org.uk>
To: fvwm-workers@hpc.uh.edu
Subject: bug in FvwmWinList
X-Mailer: VM 6.34 under Emacs 19.34.1
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

FvwmWinList creeps diagonally up and to the left by one pixel each
time a window appears or disappears.  It only does this for some
fvwm2rc files.

It happens when FvwmWinList is started and a couple of Style flags
are not set.  In particular, the following trivial fvwm2rc illustrates
the problem:

------------------------------------------------------------
Module FvwmWinList
------------------------------------------------------------


The follow is the minimum required to fix the problem:

------------------------------------------------------------
Module FvwmWinList
Style "*" NoHandles, BorderWidth 0
------------------------------------------------------------


This is the case for the FvwmWinList as distributed with fvwm2 2.0.46.

For those interested, this bug report is a much clarified form of
Debian Bug#16143.  Unnecessary gory details are at:
      http://www.debian.org/Bugs/db/16/16143.html

Thanks,
Austin
--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Mon Feb  2 10:41:56 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Mon, 02 Feb 1998 10:41:56 -0600 (CST)
Received: from mail1.doit.wisc.edu (mail1.doit.wisc.edu [144.92.9.40]) by sina.hpc.uh.edu (8.7.3/8.7.3) with ESMTP id KAA06716 for <fvwm-workers@hpc.uh.edu>; Mon, 2 Feb 1998 10:41:49 -0600 (CST)
Received: from [144.92.12.117] by mail1.doit.wisc.edu
          id KAA48550 (8.8.6/50); Mon, 2 Feb 1998 10:41:43 -0600
Message-ID: <34D5F70A.7197F682@percy.wisc.edu>
Date: Mon, 02 Feb 1998 10:40:42 -0600
From: Jui-Hsuan Joshua Feng <fengj@percy.wisc.edu>
X-Mailer: Mozilla 3.04Gold (X11; I; Linux 2.0.30 i586)
MIME-Version: 1.0
To: fvwm-workers@hpc.uh.edu
CC: fengj@percy.engr.wisc.edu
Subject: animated menu feature for FvwmButtons
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

Hi there,

I've been working on the animated menu feature for FvwmButtons.
It works. There is still something to be done about the terms
and the way I use to specify the animated menu (or panel). Where
and how should I submit the code (based on fvmw2's FvwmButtons)?

Check the web page:

http://www.cae.wisc.edu/~fengj/unix.html

There is some information about the result. Before I make any
more effort on this, I would like to know people's opions about
it (or people swith to KDE nowadays?). Thank you.
  
-- 
Jui-Hsuan Joshua Feng                         (O)608/262-3640 
Electrical & Computer Engr, University of Wisconsin - Madison    
http://www.cae.wisc.edu/~fengj           fengj@percy.wisc.edu
--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Mon Feb  2 13:13:30 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Mon, 02 Feb 1998 13:13:30 -0600 (CST)
Received: from vnet.IBM.COM (vnet.ibm.com [204.146.168.194]) by sina.hpc.uh.edu (8.7.3/8.7.3) with SMTP id NAA10897 for <fvwm-workers@hpc.uh.edu>; Mon, 2 Feb 1998 13:13:23 -0600 (CST)
Received: from FISHKILL by vnet.IBM.COM (IBM VM SMTP V2R4) with BSMTP id 9374;
   Mon, 02 Feb 98 14:13:03 EST
Received: by FISHKILL (XAGENTA 4.0) id 4714; Mon, 2 Feb 1998 14:12:51 -0500 
Received: by cold.fishkill.ibm.com (AIX 4.1/UCB 5.64/4.03)
          id AA31822; Mon, 2 Feb 1998 14:12:48 -0500
Date: Mon, 2 Feb 1998 14:12:48 -0500
Message-Id: <9802021912.AA31822@cold.fishkill.ibm.com>
From: "Charles Hines" <chuck_hines@vnet.IBM.COM>
To: Jui-Hsuan Joshua Feng <fengj@percy.wisc.edu>
Cc: fvwm-workers@hpc.uh.edu, fengj@percy.engr.wisc.edu
Subject: Re: animated menu feature for FvwmButtons
In-Reply-To: <34D5F70A.7197F682@percy.wisc.edu>
References: <34D5F70A.7197F682@percy.wisc.edu>
X-Mailer: VM 6.34 under 20.3 "Vatican City" XEmacs  Lucid
X-Face: 'pn"gAx+&w4-=-}\z>*.Y*@(lC;t1<P);@iwiv';)vn3H2\/.x#;>J[a,/Q.Yv0^Wwc6_"H]}}-"?%)ETS`1v[]P`w4,E.9Bgf*XI4<H{C}Mf@'Ms)z?Bqzf"8v/oY\9K){w}\pw
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

>>>>> "JHJF" == Jui-Hsuan Joshua Feng <fengj@percy.wisc.edu> writes:

JHJF> Hi there,

Hello.

JHJF> I've been working on the animated menu feature for FvwmButtons.
JHJF> It works. There is still something to be done about the terms
JHJF> and the way I use to specify the animated menu (or panel). Where
JHJF> and how should I submit the code (based on fvmw2's FvwmButtons)?

JHJF> Check the web page:

JHJF> http://www.cae.wisc.edu/~fengj/unix.html

JHJF> There is some information about the result. Before I make any
JHJF> more effort on this, I would like to know people's opions about
JHJF> it (or people swith to KDE nowadays?). Thank you.

Hm.  From the screen shot it looks pretty good.

Although, as you alluded to, the Panel specification and invocation
syntax may need improvement for consistency with the rest of the
FvwmButton syntax.  Perhaps something like a 'Panel' keyword with
matching 'End' (with the ability to specify overriding values for
various things) to define the panel, something like this (modifying
your example):

  *FvwmButtons(Panel(Name "Applications", Title "Apps", Columns 1,\
                     Back Grey))
  *FvwmButtons(1x1 Frame 1 Title(Left Side) Acrobat, \
               Action 'Exec /usr/local/lib/Acrobat3/bin/acroread')
  ...
  *FvwmButtons(End)

And then make it's invocation be something other than 'Panel', perhaps
'PopupPanel', 'PanelButton', or 'ShowPanel', like this:

  *FvwmButtons(3x1 Nosize Frame 1 PopupPanel 'Applications')

Just some thoughts...

As for how to submit the code, mailing a patch to the fvwm-workers
mailing list is fine, or putting it off your web page is better if it
is sizable.  I've grabbed your current version and will look at it
when I get a chance.

Chuck

--
*******************************************************************************
Charles K. Hines <chuck_hines@vnet.ibm.com>
IBM Logic Synthesis Developer [BooleDozer (TM)]
Martial Arts Instructor [Modern Arnis, Presas Style Filipino Martial Arts]

         "Go back to sleep, Chuck.  You're just havin' a nightmare
             -- of course, we ARE still in Hell." (Gary Larson)
*******************************************************************************
--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Mon Feb  2 16:36:17 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Mon, 02 Feb 1998 16:36:17 -0600 (CST)
Received: from alphatech.com (erebus.alphatech.com [198.112.236.2]) by sina.hpc.uh.edu (8.7.3/8.7.3) with SMTP id QAA14471; Mon, 2 Feb 1998 16:36:10 -0600 (CST)
Received: from venus.alphatech.com by alphatech.com (SMI-8.6/SMI-SVR4)
	id RAA23830; Mon, 2 Feb 1998 17:35:32 -0500
Received: from pochacco.alphatech.com by venus.alphatech.com (4.1/SMI-4.1)
	id AA03860; Mon, 2 Feb 98 17:41:55 EST
Received: by pochacco.alphatech.com (SMI-8.6/SMI-SVR4)
	id RAA29653; Mon, 2 Feb 1998 17:31:05 -0500
Date: Mon, 2 Feb 1998 17:31:05 -0500
Message-Id: <199802022231.RAA29653@pochacco.alphatech.com>
Mime-Version: 1.0
From: greg@alphatech.com (Greg Klanderman)
To: fvwm@hpc.uh.edu, fvwm-workers@hpc.uh.edu
Subject: 2 problems with 2.0.46
Reply-To: greg@alphatech.com
Content-Type: text/plain; charset=US-ASCII
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7


I've been using fvwm 2.0.46 for several months and have 2 nits:

First, it seems to not be possible for focus to be set on an iconified 
window.  In twm, it is possible to send keystrokes to a window through 
its Icon Manager button, whether the window is iconified or not, but
not in fvwm.  I talked to the FvwmIconMan author about this, he seemed 
to believe the problem is in fvwm proper.  I tried to play around in
gdb, but only managed to wedge myself trying to debug fvwm while it
was managing my session.  Is there some sane way to do this without
locking things up?  My XEmacs gdb window lost focus while fvwm was
stopped and I was completely hosed.

I was looking at the lines
 
>   if((Fw)&&(Fw->flags & ICONIFIED)&&(Fw->icon_w))
>     w= Fw->icon_w;
 
from fvwm/focus.c, thinking this might be the problem, but Fw->icon_w
seems to be NULL when IconMan is managing the window.  

Second, I have keystrokes bound to switch between desks.  When I
switch desks and the mouse lands in a non-sticky window, that window
gets focus.  However, if it lands in a sticky window, the window does
not get focus (no window gets focus).  Is this a known bug?

Sorry if these have been answered previously.  I tried to look through 
the archives on your web pages, but they are miserably slow from here.

Any help with these issues would be greatly appreciated.  Let me know
if you need additional information.  And keep up the great work!

Greg
greg@alphatech.com
--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Mon Feb  2 21:36:55 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Mon, 02 Feb 1998 21:36:55 -0600 (CST)
Received: from mail1.doit.wisc.edu (mail1.doit.wisc.edu [144.92.9.40]) by sina.hpc.uh.edu (8.7.3/8.7.3) with ESMTP id VAA19906 for <fvwm-workers@hpc.uh.edu>; Mon, 2 Feb 1998 21:36:36 -0600 (CST)
Received: from [144.92.12.117] by mail1.doit.wisc.edu
          id VAA15344 (8.8.6/50); Mon, 2 Feb 1998 21:36:34 -0600
Message-ID: <34D69083.28E4C6E0@percy.wisc.edu>
Date: Mon, 02 Feb 1998 21:35:31 -0600
From: Jui-Hsuan Joshua Feng <fengj@percy.wisc.edu>
X-Mailer: Mozilla 3.04Gold (X11; I; Linux 2.0.30 i586)
MIME-Version: 1.0
To: fvwm-workers@hpc.uh.edu
CC: fengj@percy.engr.wisc.edu
Subject: A patch to fvwm2-0.46's FvwmButtons for the animated menu feature
Content-Type: multipart/mixed; boundary="------------39A33F7717E2EA994F6C6285"
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

This is a multi-part message in MIME format.

--------------39A33F7717E2EA994F6C6285
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

Hi,

The patch is attached at the end of this email. I will put the
FvwmButtons source code on the following web page:

http://www.cae.wisc.edu/~fengj/P/unix.html

The syntax will be explained there too. If you have any comments
or suggestions, please let me know. Thank you.

-- 
Jui-Hsuan Joshua Feng                         (O)608/262-3640 
Electrical & Computer Engr, University of Wisconsin - Madison    
http://www.cae.wisc.edu/~fengj           fengj@percy.wisc.edu

--------------39A33F7717E2EA994F6C6285
Content-Type: text/plain; charset=us-ascii; name="patch1"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline; filename="patch1"

diff -u -b -B old/fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.c fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.c
--- old/fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.c	Thu Jun 26 16:32:31 1997
+++ fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.c	Mon Feb  2 17:21:46 1998
@@ -100,6 +100,9 @@
 
 void DebugEvents(XEvent*);
 
+panel_info *seekpanel(button_info *); 
+void Slide(panel_info *, button_info *);
+
 /* -------------------------------- globals ---------------------------------*/
 
 Display *Dpy;
@@ -136,6 +139,8 @@
 
 button_info *UberButton=NULL;
 
+panel_info *MainPanel = NULL, *CurrentPanel = NULL, *PanelIndex;  
+
 /* ------------------------------ Misc functions ----------------------------*/
 
 #ifdef DEBUG
@@ -489,7 +494,20 @@
   fprintf(stderr,"%s: Parsing...",MyName);
 # endif
 
+  
+  CurrentPanel = MainPanel
+               = (panel_info *) mymalloc(sizeof(panel_info));
+  MainPanel->next = NULL;
+  MainPanel->uber = UberButton;
+  UberButton->title   = MyName;
+  UberButton->swallow = 1; /* the panel is shown */
+
   ParseOptions(UberButton);
+
+  CurrentPanel = MainPanel; /*  reassign CurrentPanel */
+  while (CurrentPanel)
+  { UberButton = CurrentPanel->uber;
+
   if(UberButton->c->num_buttons==0)
     {
       fprintf(stderr,"%s: No buttons defined. Quitting\n", MyName);
@@ -518,6 +536,10 @@
 
   CreateWindow(UberButton,maxx,maxy);
 
+  CurrentPanel->uber->IconWinParent = MyWindow; 
+  CurrentPanel->uber->icon_w = maxx;
+  CurrentPanel->uber->icon_h = maxy;
+
 # ifdef DEBUG_INIT
   fprintf(stderr,"OK\n%s: Creating icon windows...",MyName);
 # endif
@@ -548,6 +570,13 @@
     SetTransparentBackground(UberButton,Width,Height);
 # endif
 
+  CurrentPanel = CurrentPanel->next; 
+  }
+  CurrentPanel = MainPanel;
+  UberButton   = CurrentPanel->uber;
+  MyWindow     = UberButton->IconWinParent;
+
+
 # ifdef DEBUG_INIT
   fprintf(stderr,"OK\n%s: Mapping windows...",MyName);
 # endif
@@ -594,8 +623,18 @@
 	switch(Event.type)
 	  {
 	  case Expose:
-	    if(Event.xany.window==MyWindow)
-	      {
+            PanelIndex = MainPanel; 
+            while (PanelIndex && (PanelIndex->uber->IconWinParent != Event.xany.window))
+              PanelIndex = PanelIndex->next;
+            if (PanelIndex)
+            { UberButton = PanelIndex->uber;
+              MyWindow   = UberButton->IconWinParent;
+            }
+            else
+              break;
+
+	    /* if(Event.xany.window==MyWindow)  */
+	    /*  {  */
 #ifdef OLD_EXPOSE
 		if(Event.xexpose.count == 0)
 		  {
@@ -644,11 +683,11 @@
 		    ex=ey=10000;ex2=ey2=0;
 		  }
 #endif
-              }
+            /*  }  */
 	    break;
 
 	  case ConfigureNotify:
-	    XGetGeometry(Dpy,MyWindow,&root,&x,&y,
+	  /*  XGetGeometry(Dpy,MyWindow,&root,&x,&y,
 			 (ushort*)&tw,(ushort*)&th,
 			 (ushort*)&border_width,(ushort*)&depth);
 	    if(tw!=Width || th!=Height)
@@ -660,7 +699,7 @@
 		while(NextButton(&ub,&b,&button,0))
 		  MakeButton(b);
                 RedrawWindow(NULL);
-	      }
+	      } */ /*  I don't like to change its size after it started */
 	    break;
 
 	  case KeyPress:
@@ -668,30 +707,74 @@
 	    if(keysym!=XK_Return && keysym!=XK_KP_Enter && keysym!=XK_Linefeed)
 	      break;	                /* fall through to ButtonPress */
 	  case ButtonPress:
+            
+            PanelIndex = MainPanel;
+            b = NULL;
+            do
+              if (PanelIndex->uber->swallow)
+              {
+                UberButton = PanelIndex->uber;
+                MyWindow   = UberButton->IconWinParent;
+                if (Event.xany.window == MyWindow)
+
 	    CurrentButton = b = 
 	      select_button(UberButton,Event.xbutton.x,Event.xbutton.y);
+
+              }
+            while (!b && PanelIndex->next && (PanelIndex = PanelIndex->next));
+
 	    if(!b || !(b->flags&b_Action))
 	      {
 		CurrentButton=NULL;
 		break;
 	      }
+
+            
+            CurrentPanel = PanelIndex; /* record which panel, the button pressed */
+            UberButton = CurrentPanel->uber;
+            MyWindow   = UberButton->IconWinParent;
+
 	    RedrawButton(b,0);
 	    if(!(act=GetButtonAction(b,Event.xbutton.button)))
 	      act=GetButtonAction(b,0);
 	    if(mystrncasecmp(act,"popup",5)!=0)
+	    { if (mystrncasecmp(act, "panel", 5) == 0) 
+                Slide(seekpanel(b), b);
 	      break;
+            }
 	    else /* i.e. action is Popup */
 	      XUngrabPointer(Dpy,CurrentTime); /* And fall through */
 
 	  case KeyRelease:
 	  case ButtonRelease:
+            
+            PanelIndex = MainPanel;
+            b = NULL;
+            while (PanelIndex && !b)
+            { if (PanelIndex->uber->swallow)
+              { UberButton = PanelIndex->uber;
+                MyWindow   = UberButton->IconWinParent;
+                if (Event.xany.window == MyWindow)
+
 	    b=select_button(UberButton,Event.xbutton.x,Event.xbutton.y);
+
+              }
+              PanelIndex = PanelIndex->next;
+            }
+
 	    if(!(act=GetButtonAction(b,Event.xbutton.button)))
 	      act=GetButtonAction(b,0);
 	    if(b && b==CurrentButton && act)
 	      {
 		if(mystrncasecmp(act,"Exec",4)==0)
 		  {
+                    /*  close all subpanels */
+                    PanelIndex = MainPanel->next;
+                    while (PanelIndex)
+                    { if (PanelIndex->uber->swallow) Slide(PanelIndex, NULL);
+                      PanelIndex = PanelIndex->next;
+                    }
+
 		    /* Look for Exec "identifier", in which case the button
 		       stays down until window "identifier" materializes */
 		    i=4;
@@ -728,9 +811,14 @@
 		  DumpButtons(UberButton);
 		else if(mystrncasecmp(act,"SaveButtons",11)==0)
 		  SaveButtons(UberButton);
-		else
+		else if(mystrncasecmp(act,"panel",5)) 
 		  MySendText(fd,act,0);
 	      }
+
+            /*  recover the old record */
+            UberButton = CurrentPanel->uber; /* the panel, the button pressed */
+            MyWindow   = UberButton->IconWinParent;
+
 	    b=CurrentButton;
 	    CurrentButton=NULL;
 	    if(b)
@@ -1041,6 +1129,10 @@
   unsigned long gcm;
   XClassHint myclasshints;
 
+  
+  CurrentPanel->uber->x = x; /* Geometry x where to put the panel */
+  CurrentPanel->uber->y = y; /* Geometry y where to put the panel */
+
   if(maxx<16)
     maxx=16;
   if(maxy<16)
@@ -1160,13 +1252,16 @@
 # endif
   XSetWMProtocols(Dpy,MyWindow,&_XA_WM_DEL_WIN,1);
 
-  myclasshints.res_name=strdup(MyName);
-  myclasshints.res_class=strdup("FvwmButtons");
+  
+  myclasshints.res_name=strdup((CurrentPanel == MainPanel)
+                                 ? MyName : CurrentPanel->uber->title);
+  myclasshints.res_class=strdup((CurrentPanel == MainPanel)
+                                 ? "FvwmButtons" : "FvwmButtonsPanel");
 
   {
     XTextProperty mynametext;
     char *list[]={NULL,NULL};
-    list[0]=MyName;
+    list[0]=(CurrentPanel == MainPanel) ? MyName : CurrentPanel->uber->title; 
     if(!XStringListToTextProperty(list,1,&mynametext))
       {
 	fprintf(stderr,"%s: Failed to convert name to XText\n",MyName);
@@ -1652,3 +1747,112 @@
       }
 }
 
+/* 
+ * Button
+ *   b->flags     |= b_Action (though b->hangon is ilegally used)
+ *   b->action[0]  = "panel-h" or "panel-v"
+ *   b->hangon     = panel title (case sensitive)
+ * Panel
+ *   uber->flags  |= b_Container (though the following fields are ilegally used)
+ *   uber->title   = the title of the panel
+ *   uber->IconWinParent = the panel window, will be assigned to MyWindow
+ *   uber->swallow = 0:hidden 1:shown
+ *   uber->icon_w  = panel width
+ *   uber->icon_h  = panel height
+ *   uber->x       = x position to start the panel wrt the button b
+ *   uber->y       = y position to start the panel wrt the button b
+ *   CurrentPanel  = the panel where the button b was pressed to popup a new panel
+ */
+
+#define PanelPopUpStep 16
+
+panel_info *seekpanel (button_info *b)
+{
+  panel_info *PanelIndex = MainPanel->next; /* skip the main panel */
+
+  while (PanelIndex && strcmp(b->hangon, PanelIndex->uber->title))
+    PanelIndex = PanelIndex->next;
+  
+  return PanelIndex;
+}
+
+void Slide (panel_info *p, button_info *b)
+{
+  Window PanelWin;
+  Window root;
+  int x, y, iw, ih, BW, depth;
+
+  if (!p) return;                            /* no such panel */
+  else    PanelWin = p->uber->IconWinParent; /* PanelWin is found */
+
+  if (p->uber->swallow)
+  { /* shown ---> hidden */
+    root = GetRealGeometry(Dpy, PanelWin, &x, &y,
+                           (ushort*)&iw, (ushort*)&ih,
+                           (ushort*)&BW, (ushort*)&depth);
+
+    if (b && b->action[0][6] == 'h')
+      while (PanelPopUpStep < iw)  /* horizontal */
+      { iw -= PanelPopUpStep;
+        x  += PanelPopUpStep;
+        XMoveResizeWindow(Dpy, PanelWin, x, y, iw, ih);
+      }
+    else
+      while (PanelPopUpStep < ih)  /* vertical */
+      { ih -= PanelPopUpStep;
+        y  += PanelPopUpStep;
+        XMoveResizeWindow(Dpy, PanelWin, x, y, iw, ih);
+      }
+
+    XUnmapWindow(Dpy, PanelWin);
+    p->uber->swallow = 0;
+  } 
+  else
+  { /* hidden ---> shown */
+    int ix = buttonXPos(b, b->n);  /* button in the CurrentPanel */
+    int iy = buttonYPos(b, b->n);  /* button in the CurrentPanel */
+
+    int mw = p->uber->icon_w; /* panel menu width */
+    int mh = p->uber->icon_h; /* panel menu height */
+    int w;                    /* current width */
+    int h;                    /* current height */
+
+    root = GetRealGeometry(Dpy, CurrentPanel->uber->IconWinParent, &x, &y,
+                           (ushort*)&iw, (ushort*)&ih,
+                           (ushort*)&BW, (ushort*)&depth);
+
+    x += p->uber->x + ix;
+    y += p->uber->y + iy;
+
+    /* initial position and size */
+    if (b->action[0][6] == 'h')
+    { w = mw % PanelPopUpStep;      /* horizontal */
+      if (w == 0) w = PanelPopUpStep;
+      x -= w;
+      XMoveResizeWindow(Dpy, PanelWin, x, y, w, mh);
+    }
+    else
+    { h = mh % PanelPopUpStep;      /* vertical */
+      if (h == 0) h = PanelPopUpStep;
+      y -= h;
+      XMoveResizeWindow(Dpy, PanelWin, x, y, mw, h);
+    }
+ 
+    XMapSubwindows(Dpy, PanelWin);
+    XMapWindow(Dpy, PanelWin);
+
+    if (b->action[0][6] == 'h')
+      while (w < mw)            /* horizontal */
+      { x -= PanelPopUpStep;
+        w += PanelPopUpStep;
+        XMoveResizeWindow(Dpy, PanelWin, x, y, w, mh);
+      }
+    else
+      while (h < mh)            /* vertical */
+      { y -= PanelPopUpStep;
+        h += PanelPopUpStep;
+        XMoveResizeWindow(Dpy, PanelWin, x, y, mw, h);
+      }
+    p->uber->swallow = 1;
+  }
+}
diff -u -b -B old/fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.h fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.h
--- old/fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.h	Thu Jun 26 16:32:32 1997
+++ fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.h	Mon Feb  2 17:22:11 1998
@@ -69,6 +69,7 @@
 #define b_TitleHoriz  0x03 /* Mask for title x positioning info */
 #define b_Horizontal  0x04 /* HACK: stack title and iconwin horizontally */
 
+typedef struct panel_info_struct panel_info; 
 typedef struct button_info_struct button_info;
 typedef struct container_info_struct container_info;
 #define ushort unsigned int
@@ -143,6 +144,11 @@
   ushort w,h,bw;           /* b_Swallow */
 };
 
+struct panel_info_struct   
+{ button_info  *uber;      /* panel */
+  panel_info   *next;
+};
+
 #include "button.h"
 
 /* -------------------------------- other macros --------------------------- */
@@ -173,6 +179,7 @@
 extern Window MyWindow;
 extern char *MyName;
 extern button_info *UberButton,*CurrentButton;
+extern panel_info *MainPanel, *CurrentPanel; 
 
 extern char *iconPath;
 extern char *pixmapPath;
diff -u -b -B old/fvwm-2.0.46/modules/FvwmButtons/parse.c fvwm-2.0.46/modules/FvwmButtons/parse.c
--- old/fvwm-2.0.46/modules/FvwmButtons/parse.c	Thu Jun 26 16:32:33 1997
+++ fvwm-2.0.46/modules/FvwmButtons/parse.c	Mon Feb  2 17:23:29 1998
@@ -400,6 +400,7 @@
     {
       char *opts[]={"back","fore","font","title","icon","frame","padding",
 		      "swallow","action","container","end","nosize","size",
+                      "panel", 
 		      NULL};
       trimleft(s);
       while(*s && *s!=')')
@@ -620,6 +621,42 @@
 		fprintf(stderr,"%s: Illegal size arguments\n",MyName);
 	      break;
 
+	      /* --------------------------- panel ------------------------ */
+	     
+	    case 13: /* Panel */ 
+	      trimleft(s);
+	      i=0;
+	      if(*s=='(')
+		{
+		  s++;
+		  i=strtol(s,&t,10);
+		  s=t;
+		  while(*s && *s!=')') 
+		    s++;
+		  if(*s==')')s++;
+		}
+              if (i == 1)
+              { /* horizontal */
+                AddButtonAction(b,0,strdup("panel-h"));
+                if ((~b->flags)&(b_Title | b_Icon))
+		{ b->icon_file = strdup("arrow_left.xpm");
+		  b->IconWin   = None;
+		  b->flags    |= b_Icon;
+                }
+              }
+	      else
+              { /* vertical */
+                AddButtonAction(b,0,strdup("panel-v"));
+                if ((~b->flags)&(b_Title | b_Icon))
+		{ b->icon_file = strdup("arrow_up.xpm");
+		  b->IconWin   = None;
+		  b->flags    |= b_Icon;
+                }
+              }
+	      t = seekright(&s);
+              b->hangon = strdup(t);  /* which panel to popup */
+	      break;
+
 	    default:
 	      t=seekright(&s);
 	      fprintf(stderr,"%s: Illegal button option \"%s\"\n",MyName,t);
@@ -695,7 +732,7 @@
 {
   button_info *ub=*ubb;
   char *opts[]={"geometry","font","padding","columns","rows","back","fore",
-		  "frame","file","pixmap",NULL};
+		  "frame","file","pixmap","panel",NULL}; 
   int i,j,k;
 
   switch(MatchSeveralLines(s,opts,&s))
@@ -755,6 +792,22 @@
       else
         CopyString(&(ub->c->back_file),s);
       ub->c->flags|=b_IconBack;
+      break;
+    case 10:/* Panel */ 
+      trimleft(s);
+      CurrentPanel->next = (panel_info *) mymalloc(sizeof(panel_info));
+      CurrentPanel = CurrentPanel->next;
+      CurrentPanel->next = NULL;
+      CurrentPanel->uber = UberButton
+                         = (button_info *) mymalloc(sizeof(button_info));
+      UberButton->title = seekright(&s);
+      UberButton->flags = 0;
+      UberButton->parent = NULL;
+      UberButton->BWidth = 1;
+      UberButton->BHeight = 1;
+      UberButton->swallow = 0; /* subpanel is hidden initially */
+      MakeContainer(UberButton);
+      *ubb = UberButton;
       break;
     default:
       trimleft(s);

--------------39A33F7717E2EA994F6C6285--

--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Tue Feb  3 03:22:43 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Tue, 03 Feb 1998 03:22:43 -0600 (CST)
Received: from helios.gatwick.geco-prakla.slb.com (helios.gatwick.geco-prakla.slb.com [134.32.4.55]) by sina.hpc.uh.edu (8.7.3/8.7.3) with ESMTP id DAA23626; Tue, 3 Feb 1998 03:21:28 -0600 (CST)
Received: from kerrera (kerrera [134.32.5.220])
	by helios.gatwick.geco-prakla.slb.com (8.8.8/8.8.8/1.01) with SMTP id JAA27977;
	Tue, 3 Feb 1998 09:20:53 GMT
Message-ID: <34D6DFE8.3AAC@gatwick.geco-prakla.slb.com>
Date: Tue, 03 Feb 1998 09:14:16 +0000
From: Pete Gaden <peteg@gatwick.geco-prakla.slb.com>
X-Mailer: Mozilla 3.01 (X11; I; SunOS 5.5.1 sun4m)
MIME-Version: 1.0
To: fvwm@hpc.uh.edu, fvwm-workers@hpc.uh.edu
Subject: initial window size
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

Some windows which launch on my fvwm ( in particular some child popups
of 2 main applications ) come up with incorrect initial window size.   I
have 2 which are too big and cross multiple screens and one which comes
up very small.  I am running on sun Sparc and Ultra  Workstations using
sunos 5.5.1 and fvwm 1.24.   I am reasonably confident that this is a
problem/feature of the applications as they are part of a family of
products we use.   The main point is that, under dtwm, the windows open
ok.    Anyone know of a way to make fvwm "get it wrong" like dtwm or
failing that,  the sort of problem I might look for in the application
code?



Pete
--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Tue Feb  3 04:24:19 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Tue, 03 Feb 1998 04:24:19 -0600 (CST)
Received: from heaton.cl.cam.ac.uk (exim@heaton.cl.cam.ac.uk [128.232.32.11]) by sina.hpc.uh.edu (8.7.3/8.7.3) with SMTP id EAA24149; Tue, 3 Feb 1998 04:23:56 -0600 (CST)
Received: from ivatt.cl.cam.ac.uk [128.232.0.114] (and1000)
	by heaton.cl.cam.ac.uk with smtp (Exim 1.736 #3)
	id 0xzfW7-0004xu-00; Tue, 3 Feb 1998 10:23:47 +0000
Received: from and1000 by ivatt.cl.cam.ac.uk with local (Exim 1.70 #1)
	id 0xzfW1-00044R-00; Tue, 3 Feb 1998 10:23:41 +0000
From: Austin Donnelly <and1000@cam.ac.uk>
To: greg@alphatech.com
Cc: fvwm@hpc.uh.edu, fvwm-workers@hpc.uh.edu
Subject: Re: 2 problems with 2.0.46
In-Reply-To: <199802022231.RAA29653@pochacco.alphatech.com>
References: <199802022231.RAA29653@pochacco.alphatech.com>
Message-Id: <E0xzfW1-00044R-00@ivatt.cl.cam.ac.uk>
Date: Tue, 3 Feb 1998 10:23:41 +0000
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

On Mon, 2 Feb 1998, Greg Klanderman wrote:

[debugging fvwm with gdb]

As you've found, it's quite hard debugging a window manager :)

What I do is run gdb within an xterm (possibly even within an "emacs
-nw" in the xterm).  I do a "secure keyboard" to do a keyboard grab,
and then fear no more from the window manager :) It's clearly not a
suitable way of debugging the keystroke processing logic, however.
For that, I have the luxury of virtual consoles under linux: I leave
the gdb on a text console.

Austin
--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Tue Feb  3 07:26:20 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Tue, 03 Feb 1998 07:26:20 -0600 (CST)
Received: from castle.mk.bellcore.com (castle.mk.bellcore.com [128.96.133.172]) by sina.hpc.uh.edu (8.7.3/8.7.3) with ESMTP id HAA25924; Tue, 3 Feb 1998 07:23:51 -0600 (CST)
Received: from mk.bellcore.com (fork [128.96.133.4])
	by castle.mk.bellcore.com (8.8.8/8.8.8) with ESMTP id IAA10059;
	Tue, 3 Feb 1998 08:23:21 -0500 (EST)
Message-Id: <199802031323.IAA10059@castle.mk.bellcore.com>
To: fvwm@hpc.uh.edu, fvwm-workers@hpc.uh.edu
Subject: Re: FVWM: initial window size 
In-reply-to: Your message of Tue, 03 Feb 1998 09:14:16 +0000.
             <34D6DFE8.3AAC@gatwick.geco-prakla.slb.com> 
x-face: -:-!LDdizWr~[l?RsG!7/BSm'=,`y>~^N7a#qX+.-ZUy"%YF.bP?t_E$lZG54!X1`_>u8>V
 /DpeH-oUPJ".cJfU'!(om[k{>?!DzZP&UYPi!W/]`[K`Ga+S()<~)mZlm;m}0fId<>1}XS.O+zV%w"
 1)-+K#MqP:&_@FrPF}_}R?_\"z9mHc!)e{e/DNzDY&*QoH,HGZJP#LszzhoGERD7$J4ebNt9oh-nvL
 *IX4w6m=+qtbLQrrI{-jd2Q+(ZUg,a`n58O}z/zl"
Mime-Version: 1.0 (generated by tm-edit 7.108)
Content-Type: text/plain; charset=US-ASCII
Date: Tue, 03 Feb 1998 08:23:17 -0500
From: Dan Espen <dane@mk.bellcore.com>
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

Pete Gaden <peteg@gatwick.geco-prakla.slb.com> writes:
> Some windows which launch on my fvwm ( in particular some child popups
> of 2 main applications ) come up with incorrect initial window size.   I
> have 2 which are too big and cross multiple screens and one which comes
> up very small.  I am running on sun Sparc and Ultra  Workstations using
> sunos 5.5.1 and fvwm 1.24.   I am reasonably confident that this is a
> problem/feature of the applications as they are part of a family of
> products we use.   The main point is that, under dtwm, the windows open
> ok.    Anyone know of a way to make fvwm "get it wrong" like dtwm or
> failing that,  the sort of problem I might look for in the application
> code?

Look at the window using "xwininfo -size".  

Look at all the  size hints, but  specifically see  if the  window has
defined minimum and maximum aspect ratios.

As I remember, the last time we saw this, the minimum was greater than
the maximum.

> Pete
> --

--
Dan Espen                                Phone: (732) 699-5570
444 Hoes Lane  Room RRC 1C-214           E-mail: dane@mk.bellcore.com
Piscataway, NJ 08854
--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Tue Feb  3 08:31:03 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Tue, 03 Feb 1998 08:31:03 -0600 (CST)
Received: from smtp-gw.BayNetworks.COM (ns2.BayNetworks.COM [134.177.3.16]) by sina.hpc.uh.edu (8.7.3/8.7.3) with ESMTP id IAA27109; Tue, 3 Feb 1998 08:29:20 -0600 (CST)
Received: from mailhost.BayNetworks.COM (screen2r.BayNetworks.COM [134.177.3.1])
	by smtp-gw.BayNetworks.COM (8.8.6/8.8.6) with ESMTP id GAA09821;
	Tue, 3 Feb 1998 06:28:22 -0800 (PST)
Received: from pobox.engeast.BayNetworks.COM (pobox.engeast.baynetworks.com [192.32.61.6])
	by mailhost.BayNetworks.COM (8.8.6/8.8.6) with ESMTP id JAA08339;
	Tue, 3 Feb 1998 09:27:39 -0500 (EST)
Received: from lemming.engeast (lemming [192.32.138.39])
	by pobox.engeast.BayNetworks.COM (SMI-8.6/BNET-97/04/24-S) with SMTP
	id JAA17068; Tue, 3 Feb 1998 09:28:36 -0500
	for 
Received: by lemming.engeast (4.1/SMI-4.1)
	id AA19269; Tue, 3 Feb 98 09:28:32 EST
To: Austin Donnelly <and1000@cam.ac.uk>
Cc: greg@alphatech.com, fvwm@hpc.uh.edu, fvwm-workers@hpc.uh.edu
Subject: Re: 2 problems with 2.0.46
References: <199802022231.RAA29653@pochacco.alphatech.com> <E0xzfW1-00044R-00@ivatt.cl.cam.ac.uk>
Reply-To: psmith@BayNetworks.COM
From: psmith@BayNetworks.COM (Paul D. Smith)
In-Reply-To: Austin Donnelly's message of Tue, 3 Feb 1998 10:23:41 +0000
Date: 03 Feb 1998 09:28:32 -0500
Message-Id: <p5oh0oiwz3.fsf@baynetworks.com>
Lines: 10
X-Mailer: Gnus v5.5/Emacs 20.2
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

Whenever I want to debug a window manager or similar X app, I simply use
the Xnest server.  That works _MUCH_ better and is not nearly as
difficult to use.

-- 
-------------------------------------------------------------------------------
 Paul D. Smith <psmith@baynetworks.com>         Network Management Development
 "Please remain calm...I may be mad, but I am a professional." --Mad Scientist
-------------------------------------------------------------------------------
     These are my opinions--Bay Networks takes no responsibility for them.
--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Tue Feb  3 10:22:00 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Tue, 03 Feb 1998 10:22:00 -0600 (CST)
Received: from elwha.cs.washington.edu (elwha.cs.washington.edu [128.95.1.153]) by sina.hpc.uh.edu (8.7.3/8.7.3) with ESMTP id KAA29442; Tue, 3 Feb 1998 10:21:52 -0600 (CST)
Received: (gjb@localhost) by elwha.cs.washington.edu (8.8.5+CS/7.2ws+) id IAA19554; Tue, 3 Feb 1998 08:17:45 -0800 (PST)
To: Austin Donnelly <and1000@cam.ac.uk>
Cc: greg@alphatech.com, fvwm@hpc.uh.edu, fvwm-workers@hpc.uh.edu
Subject: Re: 2 problems with 2.0.46
References: <199802022231.RAA29653@pochacco.alphatech.com> <E0xzfW1-00044R-00@ivatt.cl.cam.ac.uk>
From: Greg Badros <gjb@cs.washington.edu>
Date: 03 Feb 1998 08:17:45 -0800
In-Reply-To: Austin Donnelly's message of "Tue, 3 Feb 1998 10:23:41 +0000"
Message-ID: <qrrlnvsacie.fsf@elwha.cs.washington.edu>
Lines: 11
X-Mailer: Gnus v5.4.65/XEmacs 20.3 - "Vatican City"
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

Under Linux, I often run a second X-server on console 8 when I'm
debugging fvwm2 or SCWM; don't try it unless you have at least 20MB of
main memory, but if you do, it's a real joy.  A second machine is also
an option for some (and is the only option besides Xnest on machines
which won't run 2 X servers).

Greg J. Badros
gjb@cs.washington.edu
Seattle, WA  USA
http://www.cs.washington.edu/homes/gjb

--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Tue Feb  3 10:49:42 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Tue, 03 Feb 1998 10:49:42 -0600 (CST)
Received: from po1.glue.umd.edu (po1.glue.umd.edu [128.8.10.97]) by sina.hpc.uh.edu (8.7.3/8.7.3) with ESMTP id KAA00360 for <fvwm-workers@hpc.uh.edu>; Tue, 3 Feb 1998 10:49:35 -0600 (CST)
Received: from atlantis.csc.umd.edu (rsw@atlantis.csc.umd.edu [129.2.8.129])
	by po1.glue.umd.edu (8.8.8/8.8.7) with SMTP id LAA21201;
	Tue, 3 Feb 1998 11:49:09 -0500 (EST)
Date: Tue, 3 Feb 1998 11:49:03 -0500 (EST)
From: "Randall S. Winchester" <rsw@Glue.umd.edu>
Reply-To: "Randall S. Winchester" <rsw@Glue.umd.edu>
To: Charles Hines <chuck_hines@VNET.IBM.COM>,
        Steve Robbins <steve@nyongwa.montreal.qc.ca>
cc: fvwm-workers@hpc.uh.edu
Subject: Re: FVWM: FvwmButtons sucking up CPU... (fwd)
Message-ID: <Pine.SOL.3.95q.980203113313.19534F-202000@atlantis.csc.umd.edu>
MIME-Version: 1.0
Content-Type: MULTIPART/SIGNED; PROTOCOL="application/pgp-signature"; MICALG=pgp-md5; BOUNDARY=0ntfKIWw70PvrIHh
Content-ID: <Pine.SOL.3.95q.980203113313.19534G@atlantis.csc.umd.edu>
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

--0ntfKIWw70PvrIHh
Content-Type: TEXT/PLAIN; CHARSET=US-ASCII
Content-ID: <Pine.SOL.3.95q.980203114528.19534L@atlantis.csc.umd.edu>


Chuck and Steve,

I wanted to make sure you two incorporated this patch that was sent in by
"Grant McDorman <grant@isgtec.com " in the code base. This fixes a very long
standing bug. We have a deamon, we wrote, that runs on our machines that
looks for and kills programs that stay running when the user logs out. 
FvwmButtons has always been one of the worst offenders.

Every time I look at the modules directory I am reminded how much of the
code could/should be moved to the library. DeadPipe() is just a small
example of what would be better suited as an API that one links against.


FYI,
Randall


--0ntfKIWw70PvrIHh
Content-Type: MULTIPART/MIXED; BOUNDARY=+HP7ph2BbKc20aGI
Content-ID: <Pine.SOL.3.95q.980203113313.19534H@atlantis.csc.umd.edu>
Content-Description: 

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

--+HP7ph2BbKc20aGI
Content-Type: TEXT/PLAIN; CHARSET=us-ascii
Content-ID: <Pine.SOL.3.95q.980203113313.19534I@atlantis.csc.umd.edu>

I wrote the patch; the latest version is attached.

Other modules have the same problem; however, since they aren't used as much
the problem is not as visible.

According to Michael Tiefenback:
> On Fri, 30 Jan 1998, Jeff Wiegley wrote:
> 
> > [snip]
> > Well today Things were horrible and so I did top to see if accidentally
> > had some program I wrote churning out zombies or other detached processes
> > from my thesis program.  And what I found was I had seven instances of
> > FvwmButtons running and they were all fighting for 100%CPU attention.
> > 
> > I read the mailing list archives and noticed that others are having
> > similar problems but I couldn't find a fix for it.
> 
> My feeble memory tells me that I once suffered from this, too, in long-ago
> days (perhaps pre-version2), and that it was a (sometime later) fixed
> problem with FvwmButtons not noticing that its pipes to its parent were
> dead and gone.  The fix at the time was a few lines dealing with testing
> the read pipe returns, exiting on closure of the pipes. I haven't noticed
> it on my own office 2.0.46 setup, nor at home on the (2.0.43?) setup I'm
> running.  I hope this helps someone, although I don't see how this
> particular error could have crept back into the code. 
> 
> Michael Tiefenback
> 
> --
> Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
> To unsubscribe from the list, send "unsubscribe fvwm" in the body of a
> message to majordomo@hpc.uh.edu.
> To report problems, send mail to fvwm-owner@hpc.uh.edu.

-- 

Grant McDorman <grant@isgtec.com>
ISG Technologies, Inc.  http://www.isgtec.com
Mississauga, Ontario, Canada


--+HP7ph2BbKc20aGI
Content-Type: APPLICATION/OCTET-STREAM; CHARSET=us-ascii
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.SOL.3.95q.980203113313.19534J@atlantis.csc.umd.edu>

KioqIC4vRnZ3bUJ1dHRvbnMuYy5vcmlnCVRodSBKdW4gMjYgMTc6MzI6MzEgMTk5NwotLS0g
Li9GdndtQnV0dG9ucy5jCUZyaSBTZXAgMTkgMDk6NDU6MTAgMTk5NwoqKioqKioqKioqKioq
KioKKioqIDI3LDMyICoqKioKLS0tIDI3LDMzIC0tLS0KICAjaW5jbHVkZSA8c3RyaW5nLmg+
CiAgI2luY2x1ZGUgPHN5cy93YWl0Lmg+CiAgI2luY2x1ZGUgPHN5cy90aW1lLmg+CisgI2lu
Y2x1ZGUgPHN5cy9zdGF0Lmg+CiAgI2lmIGRlZmluZWQgX19fQUlYIHx8IGRlZmluZWQgX0FJ
WCB8fCBkZWZpbmVkIF9fUU5YX18gfHwgZGVmaW5lZCBfX19BSVhWMyB8fCBkZWZpbmVkIEFJ
WFYzIHx8IGRlZmluZWQgX1NFUVVFTlRfCiAgI2luY2x1ZGUgPHN5cy9zZWxlY3QuaD4KICAj
ZW5kaWYKKioqKioqKioqKioqKioqCioqKiA3OCw4MyAqKioqCi0tLSA3OSw4NSAtLS0tCiAg
LyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIHByb3RvdHlwZXMgLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwogIAogIHZvaWQgRGVhZFBpcGUoaW50IG5vbnNl
bnNlKTsKKyB2b2lkIENsZWFuVXAodm9pZCk7CiAgdm9pZCBTZXRCdXR0b25TaXplKGJ1dHRv
bl9pbmZvKixpbnQsaW50KTsKICAvKiBtYWluICovCiAgdm9pZCBMb29wKHZvaWQpOwoqKioq
KioqKioqKioqKioKKioqIDEyNiwxMzEgKioqKgotLS0gMTI4LDEzNSAtLS0tCiAgR0MgIE5v
cm1hbEdDOwogIGludCBXaWR0aCxIZWlnaHQ7CiAgCisgaW50IHJ1bm5pbmcgPSAxOworIAog
IGludCB4PSAtMzAwMDAseT0gLTMwMDAwLHc9IC0xLGg9IC0xLGdyYXZpdHkgPSBOb3J0aFdl
c3RHcmF2aXR5OwogIGludCBuZXdfZGVzayA9IDA7CiAgaW50IHJlYWR5ID0gMDsKKioqKioq
KioqKioqKioqCioqKiAxNzMsMTg1ICoqKioKICAqKi8KICB2b2lkIERlYWRQaXBlKGludCB3
aGF0ZXZlcikKICB7CiAgICBidXR0b25faW5mbyAqYiwqdWI9VWJlckJ1dHRvbjsKICAgIGlu
dCBidXR0b249LTE7CiAgCi0gICBzaWduYWwoU0lHUElQRSwgU0lHX0lHTik7LyogWHN5bmMg
bWF5IGNhdXNlIFNJR1BJUEUgKi8KLSAKICAgIFhTeW5jKERweSwwKTsgLyogV2FpdCBmb3Ig
dGhpbmcgdG8gc2V0dGxlIGRvd24gYSBiaXQgKi8KICAgIFhHcmFiU2VydmVyKERweSk7IC8q
IFdlIGRvbid0IHdhbnQgaW50ZXJmZXJlbmNlIHJpZ2h0IG5vdyAqLwogICAgd2hpbGUoTmV4
dEJ1dHRvbigmdWIsJmIsJmJ1dHRvbiwwKSkKICAgICAgewogICAgICAgIC8qIGRlbGV0ZSBz
d2FsbG93ZWQgd2luZG93cyAqLwotLS0gMTc3LDIyMCAtLS0tCiAgKiovCiAgdm9pZCBEZWFk
UGlwZShpbnQgd2hhdGV2ZXIpCiAgeworICAgc3RydWN0IHN0YXQgYnVmOworICAgICAKKyAg
IC8qCisgICAgKiBJZiBhIFNJR1BJUEUgYXJyaXZlcyBkdXJpbmcgdGhpcyBvcGVyYXRpb24s
IGp1c3QgZXhpdC4KKyAgICAqICAtIHRoZSBzaWduYWwgd2lsbCBwcm9iYWJseSBiZWNhdXNl
IHRoZSBzZXJ2ZXIgaXMgc2h1dHRpbmcKKyAgICAqICAgIGRvd24uIEF0dGVtcHRpbmcgdG8g
ZG8gYW55IGZ1cnRoZXIgcHJvY2Vzc2luZyBpcyB1c2VsZXNzCisgICAgKiAgICBhbmQgbWF5
IGluIGZhY3QsIG9uIHNvbWUgcGxhdGZvcm1zLCBwdXQgdGhlIHByb2Nlc3MgaW50bworICAg
ICogICAgYSB0aWdodCBsb29wIChpZiBTSUdQSVBFIGlzIGlnbm9yZWQpLgorICAgICogMjIg
SnVseSAxOTk2IEdSTS4KKyAgICAqIAorICAgICogRnVydGhlciBpbnZlc3RpZ2F0aW9uOiBY
U3luYyBtYXkgbG9vcCAqd2l0aG91dCogY2F1c2luZyBhIFNJR1BJUEUuCisgICAgKiBUaGlz
IG1heSBiZSBiZWNhdXNlIHRoZSBjb25uZWN0aW9uIGlzIGRlYWQsIG9yIGJlY2F1c2Ugb2Yg
dGhlCisgICAgKiBmYWN0IHRoYXQgWCBvcGVyYXRpb25zIGluIHNpZ25hbCBoYW5kbGVycyBh
cmUgZGlzY291cmFnZWQuCisgICAgKiAKKyAgICAqIEluIG9yZGVyIHRvIGNvdmVyIGFsbCB0
aGUgYmFzZXMsIHRoZW4sIHRoaXMgZnVuY3Rpb24gd2lsbCBub3cKKyAgICAqIHNldCBhIGds
b2JhbCBmbGFnIHdoaWNoIHdpbGwgY2F1c2UgdGhlIG1haW4gbG9vcCB0byBzdG9wLgorICAg
ICoKKyAgICAqIFNJR1BJUEUgaXMgcmVzZXQgdG8gRGVhZFBpcGUsIGFzIHdlbGwuCisgICAg
Ki8KKyAgIHNpZ25hbChTSUdQSVBFLCBEZWFkUGlwZSk7CisgCisgICAvKgorICAgICogVHJ5
IHRvIGNoZWNrIHN0YXR1cyBvZiBYIGNvbm5lY3Rpb24uCisgICAgKi8KKyAgIGlmIChmc3Rh
dChYQ29ubmVjdGlvbk51bWJlcihEcHkpLCAmYnVmKSA9PSAtMSkKKyAgICAgICBleGl0KDAp
OworICAgCisgICBydW5uaW5nID0gMDsKKyB9CisgCisgdm9pZCBDbGVhblVwKHZvaWQpCisg
ewogICAgYnV0dG9uX2luZm8gKmIsKnViPVViZXJCdXR0b247CiAgICBpbnQgYnV0dG9uPS0x
OwogIAogICAgWFN5bmMoRHB5LDApOyAvKiBXYWl0IGZvciB0aGluZyB0byBzZXR0bGUgZG93
biBhIGJpdCAqLwogICAgWEdyYWJTZXJ2ZXIoRHB5KTsgLyogV2UgZG9uJ3Qgd2FudCBpbnRl
cmZlcmVuY2UgcmlnaHQgbm93ICovCisgCiAgICB3aGlsZShOZXh0QnV0dG9uKCZ1YiwmYiwm
YnV0dG9uLDApKQogICAgICB7CiAgICAgICAgLyogZGVsZXRlIHN3YWxsb3dlZCB3aW5kb3dz
ICovCioqKioqKioqKioqKioqKgoqKiogNTg3LDU5MyAqKioqCiAgICBpbnQgZXg9MTAwMDAs
ZXk9MTAwMDAsZXgyPTAsZXkyPTA7CiAgI2VuZGlmCiAgCiEgICB3aGlsZSgxKQogICAgICB7
CiAgICAgICAgaWYoTXlfWE5leHRFdmVudChEcHksJkV2ZW50KSkKICAJewotLS0gNjIyLDYy
OCAtLS0tCiAgICBpbnQgZXg9MTAwMDAsZXk9MTAwMDAsZXgyPTAsZXkyPTA7CiAgI2VuZGlm
CiAgCiEgICB3aGlsZShydW5uaW5nKQogICAgICB7CiAgICAgICAgaWYoTXlfWE5leHRFdmVu
dChEcHksJkV2ZW50KSkKICAJewoqKioqKioqKioqKioqKioKKioqIDgxNCw4MTkgKioqKgot
LS0gODQ5LDg1NSAtLS0tCiAgCSAgfQogICAgICAgIH0KICAgICAgfQorICAgICBDbGVhblVw
KCk7CiAgfQogIAogIC8qKgoqKiogLi9wYXJzZS5jLm9yaWcJVGh1IEp1biAyNiAxNzozMjoz
MyAxOTk3Ci0tLSAuL3BhcnNlLmMJRnJpIFNlcCAxOSAwOTo0NToxMCAxOTk3CioqKioqKioq
KioqKioqKgoqKiogNjcwLDY3NSAqKioqCi0tLSA2NzAsNjgyIC0tLS0KICAJICBleGl0KDEp
OwogIAl9CiAgICAgICAgcys9NzsKKyAgICAgICAvKgorICAgICAgICAqIFN3YWxsb3cgb2xk
ICdzd2FsbG93bW9kdWxlJyBjb21tYW5kCisgICAgICAgICovCisgICAgICAgaWYgKG15c3Ry
bmNhc2VjbXAocywibW9kdWxlIiw2KT09MCkKKyAgICAgICB7CisgICAgICAgICAgIHMrPTY7
CisgICAgICAgfQogICAgICAgIGItPmhhbmdvbj1zZWVrcmlnaHQoJnMpOwogICAgICAgIGIt
PmZsYWdzfD0oYl9Td2FsbG93fGJfSGFuZ29uKTsKICAgICAgICBiLT5zd2FsbG93fD0xOwo=

--+HP7ph2BbKc20aGI--
--0ntfKIWw70PvrIHh
Content-Type: APPLICATION/PGP-SIGNATURE
Content-ID: <Pine.SOL.3.95q.980203113313.19534K@atlantis.csc.umd.edu>
Content-Description: 

-----BEGIN PGP SIGNATURE-----
Version: 2.6.2

iQBVAwUBNNJFwUDmya2cFZ8ZAQGAKwH/W9ltlPyqUzWbHaIbVHWyt7QxxkejNsNt
DjveIJFkkiLoPEWQ3ccOQ6Pq6uUUEsnLnbvvrVSNx2xwEOKNkh7T6g==
=ETqI
-----END PGP SIGNATURE-----

--0ntfKIWw70PvrIHh--
--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Tue Feb  3 11:22:05 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Tue, 03 Feb 1998 11:22:05 -0600 (CST)
Received: from VNET.IBM.COM (vnet.ibm.com [204.146.168.194]) by sina.hpc.uh.edu (8.7.3/8.7.3) with SMTP id LAA00810 for <fvwm-workers@hpc.uh.edu>; Tue, 3 Feb 1998 11:21:57 -0600 (CST)
Received: from FISHKILL by VNET.IBM.COM (IBM VM SMTP V2R4) with BSMTP id 9673;
   Tue, 03 Feb 98 12:21:50 EST
Received: by FISHKILL (XAGENTA 4.0) id 4904; Tue, 3 Feb 1998 12:21:39 -0500 
Received: by cold.fishkill.ibm.com (AIX 4.1/UCB 5.64/4.03)
          id AA28156; Tue, 3 Feb 1998 12:21:36 -0500
Date: Tue, 3 Feb 1998 12:21:36 -0500
Message-Id: <9802031721.AA28156@cold.fishkill.ibm.com>
From: "Charles Hines" <chuck_hines@VNET.IBM.COM>
To: "Randall S. Winchester" <rsw@Glue.umd.edu>
Cc: Steve Robbins <steve@nyongwa.montreal.qc.ca>, fvwm-workers@hpc.uh.edu
Subject: Re: FVWM: FvwmButtons sucking up CPU... (fwd)
In-Reply-To: <Pine.SOL.3.95q.980203113313.19534F-202000@atlantis.csc.umd.edu>
References: <Pine.SOL.3.95q.980203113313.19534F-202000@atlantis.csc.umd.edu>
X-Mailer: VM 6.34 under 20.3 "Vatican City" XEmacs  Lucid
X-Face: 'pn"gAx+&w4-=-}\z>*.Y*@(lC;t1<P);@iwiv';)vn3H2\/.x#;>J[a,/Q.Yv0^Wwc6_"H]}}-"?%)ETS`1v[]P`w4,E.9Bgf*XI4<H{C}Mf@'Ms)z?Bqzf"8v/oY\9K){w}\pw
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

>>>>> "rsw" == Randall S Winchester <rsw@Glue.umd.edu> writes:

rsw> Chuck and Steve,

rsw> I wanted to make sure you two incorporated this patch that was
rsw> sent in by "Grant McDorman <grant@isgtec.com " in the code
rsw> base. This fixes a very long standing bug. We have a deamon, we
rsw> wrote, that runs on our machines that looks for and kills
rsw> programs that stay running when the user logs out.  FvwmButtons
rsw> has always been one of the worst offenders.

I've already incorporated a version of this patch into my development
version, so it will be in 2.0.47, never fear.  I did do it slightly
differently though (basically just made every DeadPipe just exit).

rsw> Every time I look at the modules directory I am reminded how much
rsw> of the code could/should be moved to the library. DeadPipe() is
rsw> just a small example of what would be better suited as an API
rsw> that one links against.

Actually, for most of them a SIGPIPE handler probably isn't even
needed since the default action for a SIGPIPE is to just call _exit()
anyways.  Perhaps I'll go through and remove all of the ones that are
truly unnecessary.

But yes, there is a lot of other module code that could be moved to
the library or into it's own module-common library, and I keep that in
mind (it's been on the TO-DO list for quite some time, but it's not as
vital as other things just yet).

Chuck
--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Wed Feb 11 22:50:29 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Wed, 11 Feb 1998 22:50:29 -0600 (CST)
Received: from mail1.doit.wisc.edu (mail1.doit.wisc.edu [144.92.9.40]) by sina.hpc.uh.edu (8.7.3/8.7.3) with ESMTP id WAA24954 for <fvwm-workers@hpc.uh.edu>; Wed, 11 Feb 1998 22:50:21 -0600 (CST)
Received: from [144.92.12.117] by mail1.doit.wisc.edu
          id WAA50820 (8.8.6/50); Wed, 11 Feb 1998 22:50:16 -0600
Message-ID: <34E27F34.125CD889@percy.wisc.edu>
Date: Wed, 11 Feb 1998 22:48:52 -0600
From: Jui-Hsuan Joshua Feng <fengj@percy.wisc.edu>
X-Mailer: Mozilla 3.04Gold (X11; I; Linux 2.0.30 i586)
MIME-Version: 1.0
To: fvwm-workers@hpc.uh.edu
Subject: FvwmButtons Patch: animated menu + autohide
Content-Type: multipart/mixed; boundary="------------2DA95659785F275C17DD414F"
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

This is a multi-part message in MIME format.

--------------2DA95659785F275C17DD414F
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

Hi there,

The following is a patch to the fvwm-2.0.46's FvwmButtons.
There was a minor bug in my previous patch. It's fixed now. I am
not totally satisfied with the autohide feature. I will post
the patch for animated menu alone later. So if you don't want to
try the 'FvwmButtonsAutoHide', you can grab that patch instead.
Or visit:

http://www.cae.wisc.edu/~fengj/P/unix.html
(Note: Still under construction)

The difficulty in present FvwmButtonsAutoHide is that fvwm somehow
change the mouse index mode when it get close to the boundary. So
fvwm won't detect the 'EnterNotify' signal. Furthermore, FvwmButtons
is a large collection of windows, when the index wanders in it,
fvwm will detect several EnterNotify signals. Fvwm2 experts help
us out here.

-- 
Jui-Hsuan Joshua Feng                         (O)608/262-3640 
Electrical & Computer Engr, University of Wisconsin - Madison    
http://www.cae.wisc.edu/~fengj           fengj@percy.wisc.edu

--------------2DA95659785F275C17DD414F
Content-Type: text/plain; charset=us-ascii; name="patch3"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline; filename="patch3"

diff -u -b -B old/fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.c fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.c
--- old/fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.c	Thu Jun 26 16:32:31 1997
+++ fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.c	Wed Feb 11 22:27:20 1998
@@ -58,7 +58,8 @@
 #define MW_EVENTS   (ExposureMask |\
 		     StructureNotifyMask |\
 		     ButtonReleaseMask | ButtonPressMask |\
-		     KeyReleaseMask | KeyPressMask)
+		     KeyReleaseMask | KeyPressMask |\
+                     EnterWindowMask | LeaveWindowMask)
 /* SW_EVENTS are for swallowed windows... */
 #define SW_EVENTS   (PropertyChangeMask | StructureNotifyMask |\
 		     ResizeRedirectMask | SubstructureNotifyMask)
@@ -100,6 +101,9 @@
 
 void DebugEvents(XEvent*);
 
+panel_info *seekpanel(button_info *);
+void Slide(panel_info *, button_info *);
+
 /* -------------------------------- globals ---------------------------------*/
 
 Display *Dpy;
@@ -136,6 +140,10 @@
 
 button_info *UberButton=NULL;
 
+panel_info *MainPanel = NULL, *CurrentPanel = NULL, *PanelIndex;
+int AutoHide = 0, HoldMainPanel = 1, dpw, dph;
+#define ShowWidth 4
+
 /* ------------------------------ Misc functions ----------------------------*/
 
 #ifdef DEBUG
@@ -485,11 +493,26 @@
   UberButton->BHeight=1;
   MakeContainer(UberButton);
 
+  dpw = DisplayWidth(Dpy,screen);
+  dph = DisplayHeight(Dpy,screen);
+
 # ifdef DEBUG_INIT
   fprintf(stderr,"%s: Parsing...",MyName);
 # endif
 
+  CurrentPanel = MainPanel
+               = (panel_info *) mymalloc(sizeof(panel_info));
+  MainPanel->next = NULL;
+  MainPanel->uber = UberButton;
+  UberButton->title   = MyName;
+  UberButton->swallow = 1; /* the panel is shown */
+
   ParseOptions(UberButton);
+
+  CurrentPanel = MainPanel; /* reassign CurrentPanel */
+  while (CurrentPanel)
+  { UberButton = CurrentPanel->uber;
+
   if(UberButton->c->num_buttons==0)
     {
       fprintf(stderr,"%s: No buttons defined. Quitting\n", MyName);
@@ -518,6 +541,10 @@
 
   CreateWindow(UberButton,maxx,maxy);
 
+    CurrentPanel->uber->IconWinParent = MyWindow;
+    CurrentPanel->uber->icon_w = maxx;
+    CurrentPanel->uber->icon_h = maxy;
+
 # ifdef DEBUG_INIT
   fprintf(stderr,"OK\n%s: Creating icon windows...",MyName);
 # endif
@@ -548,6 +575,13 @@
     SetTransparentBackground(UberButton,Width,Height);
 # endif
 
+    CurrentPanel = CurrentPanel->next;
+  }
+  CurrentPanel = MainPanel;
+  UberButton   = CurrentPanel->uber;
+  MyWindow     = UberButton->IconWinParent;
+
+
 # ifdef DEBUG_INIT
   fprintf(stderr,"OK\n%s: Mapping windows...",MyName);
 # endif
@@ -594,8 +628,16 @@
 	switch(Event.type)
 	  {
 	  case Expose:
-	    if(Event.xany.window==MyWindow)
-	      {
+            PanelIndex = MainPanel;
+            while (PanelIndex && (PanelIndex->uber->IconWinParent != Event.xany.window))
+              PanelIndex = PanelIndex->next;
+            if (PanelIndex)
+            { UberButton = PanelIndex->uber;
+              MyWindow   = UberButton->IconWinParent;
+            }
+            else
+              break;
+
 #ifdef OLD_EXPOSE
 		if(Event.xexpose.count == 0)
 		  {
@@ -644,11 +686,10 @@
 		    ex=ey=10000;ex2=ey2=0;
 		  }
 #endif
-              }
 	    break;
 
 	  case ConfigureNotify:
-	    XGetGeometry(Dpy,MyWindow,&root,&x,&y,
+	    /* XGetGeometry(Dpy, MyWindow, &root, &x, &y,
 			 (ushort*)&tw,(ushort*)&th,
 			 (ushort*)&border_width,(ushort*)&depth);
 	    if(tw!=Width || th!=Height)
@@ -660,7 +701,7 @@
 		while(NextButton(&ub,&b,&button,0))
 		  MakeButton(b);
                 RedrawWindow(NULL);
-	      }
+	      } */ /* I don't like to change its size after it started */
 	    break;
 
 	  case KeyPress:
@@ -668,30 +709,68 @@
 	    if(keysym!=XK_Return && keysym!=XK_KP_Enter && keysym!=XK_Linefeed)
 	      break;	                /* fall through to ButtonPress */
 	  case ButtonPress:
+            PanelIndex = MainPanel;
+            b = NULL;
+            do
+              if (PanelIndex->uber->swallow)
+              {
+                UberButton = PanelIndex->uber;
+                MyWindow   = UberButton->IconWinParent;
+                if (Event.xany.window == MyWindow)
 	    CurrentButton = b = 
 	      select_button(UberButton,Event.xbutton.x,Event.xbutton.y);
+
+              }
+            while (!b && PanelIndex->next && (PanelIndex = PanelIndex->next));
+
 	    if(!b || !(b->flags&b_Action))
 	      {
 		CurrentButton=NULL;
 		break;
 	      }
+
+            CurrentPanel = PanelIndex; /* record which panel, the button pressed */
+            UberButton = CurrentPanel->uber;
+            MyWindow   = UberButton->IconWinParent;
+
 	    RedrawButton(b,0);
 	    if(!(act=GetButtonAction(b,Event.xbutton.button)))
 	      act=GetButtonAction(b,0);
 	    if(mystrncasecmp(act,"popup",5)!=0)
+	    { if (mystrncasecmp(act, "panel", 5) == 0)
+                Slide(seekpanel(b), b);
 	      break;
+            }
 	    else /* i.e. action is Popup */
 	      XUngrabPointer(Dpy,CurrentTime); /* And fall through */
 
 	  case KeyRelease:
 	  case ButtonRelease:
+            PanelIndex = MainPanel;
+            b = NULL;
+            while (PanelIndex && !b)
+            { if (PanelIndex->uber->swallow)
+              { UberButton = PanelIndex->uber;
+                MyWindow   = UberButton->IconWinParent;
+                if (Event.xany.window == MyWindow)
 	    b=select_button(UberButton,Event.xbutton.x,Event.xbutton.y);
+              }
+              PanelIndex = PanelIndex->next;
+            }
+
 	    if(!(act=GetButtonAction(b,Event.xbutton.button)))
 	      act=GetButtonAction(b,0);
 	    if(b && b==CurrentButton && act)
 	      {
 		if(mystrncasecmp(act,"Exec",4)==0)
 		  {
+                    /* close all subpanels */
+                    PanelIndex = MainPanel->next;
+                    while (PanelIndex)
+                    { if (PanelIndex->uber->swallow) Slide(PanelIndex, NULL);
+                      PanelIndex = PanelIndex->next;
+                    }
+
 		    /* Look for Exec "identifier", in which case the button
 		       stays down until window "identifier" materializes */
 		    i=4;
@@ -728,9 +807,14 @@
 		  DumpButtons(UberButton);
 		else if(mystrncasecmp(act,"SaveButtons",11)==0)
 		  SaveButtons(UberButton);
-		else
+		else if(mystrncasecmp(act,"panel",5))
 		  MySendText(fd,act,0);
 	      }
+
+            /* recover the old record */
+            UberButton = CurrentPanel->uber; /* the panel, the button pressed */
+            MyWindow   = UberButton->IconWinParent;
+
 	    b=CurrentButton;
 	    CurrentButton=NULL;
 	    if(b)
@@ -806,6 +890,38 @@
 		}
 	    break;
 
+          case EnterNotify:
+            if (AutoHide && HoldMainPanel)
+            {
+              GetRealGeometry(Dpy, MainPanel->uber->IconWinParent, &x, &y,
+		   	      (ushort*)&tw, (ushort*)&th,
+			      (ushort*)&border_width, (ushort*)&depth);
+              if (((AutoHide == 2) && (x+tw > dpw) && (x = dpw - tw)) ||
+                  ((AutoHide == 1) && (y+th > dph) && (y = dph - th)))
+              { XMoveWindow(Dpy, MainPanel->uber->IconWinParent, x, y);
+                HoldMainPanel = 0;
+              }
+            }
+            break;
+          case LeaveNotify:
+            if (AutoHide && !HoldMainPanel)
+            {
+              GetRealGeometry(Dpy, MainPanel->uber->IconWinParent, &x, &y,
+                              (ushort*)&tw, (ushort*)&th,
+                              (ushort*)&border_width, (ushort*)&depth);
+              if (((0  >  Event.xcrossing.x) || (0  >  Event.xcrossing.y) ||
+                   (tw <= Event.xcrossing.x) || (th <= Event.xcrossing.y)
+                  ) &&
+                  (((AutoHide == 2) && (x+tw >= dpw) && (x = dpw-ShowWidth)) ||
+                   ((AutoHide == 1) && (y+th >= dph) && (y = dph-ShowWidth))
+                  )
+                 )
+              { XMoveWindow(Dpy, MainPanel->uber->IconWinParent, x, y);
+                HoldMainPanel = 1;
+              }
+            }
+            break;
+
 	  default:
 #           ifdef DEBUG_EVENTS
 	    fprintf(stderr,"%s: Event fell through unhandled\n",MyName);
@@ -1041,6 +1157,11 @@
   unsigned long gcm;
   XClassHint myclasshints;
 
+  x = CurrentPanel->uber->x; /* Geometry x where to put the panel */
+  y = CurrentPanel->uber->y; /* Geometry y where to put the panel */
+  xneg = CurrentPanel->uber->w;
+  yneg = CurrentPanel->uber->h;
+
   if(maxx<16)
     maxx=16;
   if(maxy<16)
@@ -1160,13 +1281,15 @@
 # endif
   XSetWMProtocols(Dpy,MyWindow,&_XA_WM_DEL_WIN,1);
 
-  myclasshints.res_name=strdup(MyName);
-  myclasshints.res_class=strdup("FvwmButtons");
+  myclasshints.res_name=strdup((CurrentPanel == MainPanel)
+                                 ? MyName : CurrentPanel->uber->title);
+  myclasshints.res_class=strdup((CurrentPanel == MainPanel)
+                                 ? "FvwmButtons" : "FvwmButtonsPanel");
 
   {
     XTextProperty mynametext;
     char *list[]={NULL,NULL};
-    list[0]=MyName;
+    list[0]=(CurrentPanel == MainPanel) ? MyName : CurrentPanel->uber->title;
     if(!XStringListToTextProperty(list,1,&mynametext))
       {
 	fprintf(stderr,"%s: Failed to convert name to XText\n",MyName);
@@ -1652,3 +1775,116 @@
       }
 }
 
+/*
+ * Button
+ *   b->flags     |= b_Action (though b->hangon is ilegally used)
+ *   b->action[0]  = "panel-h" or "panel-v"
+ *   b->hangon     = panel title (case sensitive)
+ * Panel
+ *   uber->flags  |= b_Container (though the following fields are ilegally used)
+ *   uber->title   = the title of the panel
+ *   uber->IconWinParent = the panel window, will be assigned to MyWindow
+ *   uber->swallow = 0:hidden 1:shown
+ *   uber->icon_w  = panel width
+ *   uber->icon_h  = panel height
+ *   uber->x       = x position to start the panel wrt the button b
+ *   uber->y       = y position to start the panel wrt the button b
+ *   uber->w       = xneg
+ *   uber->h       = yneg
+ *   CurrentPanel  = the panel where the button b was pressed to popup a new panel
+ */
+
+#define PanelPopUpStep 32
+
+panel_info *seekpanel (button_info *b)
+{
+  panel_info *PanelIndex = MainPanel->next; /* skip the main panel */
+
+  while (PanelIndex && strcmp(b->hangon, PanelIndex->uber->title))
+    PanelIndex = PanelIndex->next;
+  
+  return PanelIndex;
+}
+
+void Slide (panel_info *p, button_info *b)
+{
+  Window PanelWin;
+  Window root;
+  int x, y, iw, ih, BW, depth;
+
+  if (!p) return;                            /* no such panel */
+  else    PanelWin = p->uber->IconWinParent; /* PanelWin is found */
+
+  if (p->uber->swallow)
+  { /* shown ---> hidden */
+    root = GetRealGeometry(Dpy, PanelWin, &x, &y,
+                           (ushort*)&iw, (ushort*)&ih,
+                           (ushort*)&BW, (ushort*)&depth);
+
+    if (b && b->action[0][6] == 'h')
+      while (PanelPopUpStep < iw)  /* horizontal */
+      { iw -= PanelPopUpStep;
+        x  += PanelPopUpStep;
+        XMoveResizeWindow(Dpy, PanelWin, x, y, iw, ih);
+      }
+    else
+      while (PanelPopUpStep < ih)  /* vertical */
+      { ih -= PanelPopUpStep;
+        y  += PanelPopUpStep;
+        XMoveResizeWindow(Dpy, PanelWin, x, y, iw, ih);
+      }
+
+    XUnmapWindow(Dpy, PanelWin);
+    p->uber->swallow = 0;
+    HoldMainPanel--;               /* facilitate AutoHide */
+  } 
+  else
+  { /* hidden ---> shown */
+    int ix = buttonXPos(b, b->n);  /* button in the CurrentPanel */
+    int iy = buttonYPos(b, b->n);  /* button in the CurrentPanel */
+
+    int mw = p->uber->icon_w; /* panel menu width */
+    int mh = p->uber->icon_h; /* panel menu height */
+    int w;                    /* current width */
+    int h;                    /* current height */
+
+    root = GetRealGeometry(Dpy, CurrentPanel->uber->IconWinParent, &x, &y,
+                           (ushort*)&iw, (ushort*)&ih,
+                           (ushort*)&BW, (ushort*)&depth);
+
+    x += p->uber->x + ix;
+    y += p->uber->y + iy;
+
+    /* initial position and size */
+    if (b->action[0][6] == 'h')
+    { w = mw % PanelPopUpStep;      /* horizontal */
+      if (w == 0) w = PanelPopUpStep;
+      x -= w;
+      XMoveResizeWindow(Dpy, PanelWin, x, y, w, mh);
+    }
+    else
+    { h = mh % PanelPopUpStep;      /* vertical */
+      if (h == 0) h = PanelPopUpStep;
+      y -= h;
+      XMoveResizeWindow(Dpy, PanelWin, x, y, mw, h);
+    }
+ 
+    XMapSubwindows(Dpy, PanelWin);
+    XMapWindow(Dpy, PanelWin);
+
+    if (b->action[0][6] == 'h')
+      while (w < mw)            /* horizontal */
+      { x -= PanelPopUpStep;
+        w += PanelPopUpStep;
+        XMoveResizeWindow(Dpy, PanelWin, x, y, w, mh);
+      }
+    else
+      while (h < mh)            /* vertical */
+      { y -= PanelPopUpStep;
+        h += PanelPopUpStep;
+        XMoveResizeWindow(Dpy, PanelWin, x, y, mw, h);
+      }
+    p->uber->swallow = 1;
+    HoldMainPanel++;            /* hinder AutoHide */
+  }
+}
diff -u -b -B old/fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.h fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.h
--- old/fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.h	Thu Jun 26 16:32:32 1997
+++ fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.h	Mon Feb  2 22:19:39 1998
@@ -69,6 +69,7 @@
 #define b_TitleHoriz  0x03 /* Mask for title x positioning info */
 #define b_Horizontal  0x04 /* HACK: stack title and iconwin horizontally */
 
+typedef struct panel_info_struct panel_info;
 typedef struct button_info_struct button_info;
 typedef struct container_info_struct container_info;
 #define ushort unsigned int
@@ -143,6 +144,11 @@
   ushort w,h,bw;           /* b_Swallow */
 };
 
+struct panel_info_struct
+{ button_info  *uber;      /* panel */
+  panel_info   *next;
+};
+
 #include "button.h"
 
 /* -------------------------------- other macros --------------------------- */
@@ -173,6 +179,7 @@
 extern Window MyWindow;
 extern char *MyName;
 extern button_info *UberButton,*CurrentButton;
+extern panel_info *MainPanel, *CurrentPanel;
 
 extern char *iconPath;
 extern char *pixmapPath;
Only in fvwm-2.0.46/modules/FvwmButtons: Makefile
diff -u -b -B old/fvwm-2.0.46/modules/FvwmButtons/parse.c fvwm-2.0.46/modules/FvwmButtons/parse.c
--- old/fvwm-2.0.46/modules/FvwmButtons/parse.c	Thu Jun 26 16:32:33 1997
+++ fvwm-2.0.46/modules/FvwmButtons/parse.c	Wed Feb 11 22:04:49 1998
@@ -28,8 +28,9 @@
 #include "FvwmButtons.h"
 #include "button.h"
 
-extern int w,h,x,y,xneg,yneg;
+extern int w,h,x,y,xneg,yneg; /* used in ParseConfigLine */ 
 extern char *config_file;
+extern AutoHide;
 
 /* ----------------------------------- macros ------------------------------ */
 
@@ -400,6 +401,7 @@
     {
       char *opts[]={"back","fore","font","title","icon","frame","padding",
 		      "swallow","action","container","end","nosize","size",
+                      "panel",
 		      NULL};
       trimleft(s);
       while(*s && *s!=')')
@@ -620,6 +622,42 @@
 		fprintf(stderr,"%s: Illegal size arguments\n",MyName);
 	      break;
 
+	      /* --------------------------- panel ------------------------ */
+	     
+	    case 13: /* Panel */
+	      trimleft(s);
+	      i=0;
+	      if(*s=='(')
+		{
+		  s++;
+		  i=strtol(s,&t,10);
+		  s=t;
+		  while(*s && *s!=')') 
+		    s++;
+		  if(*s==')')s++;
+		}
+              if (i == 1)
+              { /* horizontal */
+                AddButtonAction(b,0,strdup("panel-h"));
+                if ((~b->flags)&(b_Title | b_Icon))
+		{ b->icon_file = strdup("arrow_left.xpm");
+		  b->IconWin   = None;
+		  b->flags    |= b_Icon;
+                }
+              }
+	      else
+              { /* vertical */
+                AddButtonAction(b,0,strdup("panel-v"));
+                if ((~b->flags)&(b_Title | b_Icon))
+		{ b->icon_file = strdup("arrow_up.xpm");
+		  b->IconWin   = None;
+		  b->flags    |= b_Icon;
+                }
+              }
+	      t = seekright(&s);
+              b->hangon = strdup(t);  /* which panel to popup */
+	      break;
+
 	    default:
 	      t=seekright(&s);
 	      fprintf(stderr,"%s: Illegal button option \"%s\"\n",MyName,t);
@@ -695,7 +733,7 @@
 {
   button_info *ub=*ubb;
   char *opts[]={"geometry","font","padding","columns","rows","back","fore",
-		  "frame","file","pixmap",NULL};
+		  "frame","file","pixmap","panel","autohide",NULL};
   int i,j,k;
 
   switch(MatchSeveralLines(s,opts,&s))
@@ -711,10 +749,10 @@
 	    flags=XParseGeometry(geom,&g_x,&g_y,&width,&height);
 	    if(flags&WidthValue) w=width;
 	    if(flags&HeightValue) h=height;
-	    if(flags&XValue) x=g_x;
-	    if(flags&YValue) y=g_y;
-	    if(flags&XNegative) xneg=1;
-	    if(flags&YNegative) yneg=1;
+	    if(flags&XValue)    UberButton->x = g_x;
+	    if(flags&YValue)    UberButton->y = g_y;
+	    if(flags&XNegative) UberButton->w = 1;
+	    if(flags&YNegative) UberButton->h = 1;
 	  }
 	break;
       }
@@ -755,6 +793,25 @@
       else
         CopyString(&(ub->c->back_file),s);
       ub->c->flags|=b_IconBack;
+      break;
+    case 10:/* Panel */
+      trimleft(s);
+      CurrentPanel->next = (panel_info *) mymalloc(sizeof(panel_info));
+      CurrentPanel = CurrentPanel->next;
+      CurrentPanel->next = NULL;
+      CurrentPanel->uber = UberButton
+                         = (button_info *) mymalloc(sizeof(button_info));
+      UberButton->title = seekright(&s);
+      UberButton->flags = 0;
+      UberButton->parent = NULL;
+      UberButton->BWidth = 1;
+      UberButton->BHeight = 1;
+      UberButton->swallow = 0; /* subpanel is hidden initially */
+      MakeContainer(UberButton);
+      *ubb = UberButton;
+      break;
+    case 11:/* AutoHide */
+      if (sscanf(s, "%d", &j)) AutoHide = j;
       break;
     default:
       trimleft(s);

--------------2DA95659785F275C17DD414F--

--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Wed Feb 11 23:14:49 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Wed, 11 Feb 1998 23:14:49 -0600 (CST)
Received: from mail1.doit.wisc.edu (mail1.doit.wisc.edu [144.92.9.40]) by sina.hpc.uh.edu (8.7.3/8.7.3) with ESMTP id XAA25179 for <fvwm-workers@hpc.uh.edu>; Wed, 11 Feb 1998 23:14:41 -0600 (CST)
Received: from [144.92.12.117] by mail1.doit.wisc.edu
          id XAA18536 (8.8.6/50); Wed, 11 Feb 1998 23:14:36 -0600
Message-ID: <34E284E8.5E8DA554@percy.wisc.edu>
Date: Wed, 11 Feb 1998 23:13:12 -0600
From: Jui-Hsuan Joshua Feng <fengj@percy.wisc.edu>
X-Mailer: Mozilla 3.04Gold (X11; I; Linux 2.0.30 i586)
MIME-Version: 1.0
To: fvwm-workers@hpc.uh.edu
CC: fengj@percy.engr.wisc.edu
Subject: FvwmButtons Patch: animated menu only
Content-Type: multipart/mixed; boundary="------------61E85DBC3C3678333C1DCA9"
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

This is a multi-part message in MIME format.

--------------61E85DBC3C3678333C1DCA9
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

Hi,

This is for the animated menu feature only (fixed version).
If you have any comments or suggestions, please let me know.

-- 
Jui-Hsuan Joshua Feng                         (O)608/262-3640 
Electrical & Computer Engr, University of Wisconsin - Madison    
http://www.cae.wisc.edu/~fengj           fengj@percy.wisc.edu

--------------61E85DBC3C3678333C1DCA9
Content-Type: text/plain; charset=us-ascii; name="patch2"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline; filename="patch2"

diff -u -b -B old/fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.c fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.c
--- old/fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.c	Thu Jun 26 16:32:31 1997
+++ fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.c	Wed Feb 11 23:05:02 1998
@@ -100,6 +100,9 @@
 
 void DebugEvents(XEvent*);
 
+panel_info *seekpanel(button_info *);
+void Slide(panel_info *, button_info *);
+
 /* -------------------------------- globals ---------------------------------*/
 
 Display *Dpy;
@@ -136,6 +139,9 @@
 
 button_info *UberButton=NULL;
 
+panel_info *MainPanel = NULL, *CurrentPanel = NULL, *PanelIndex;
+int dpw, dph;
+
 /* ------------------------------ Misc functions ----------------------------*/
 
 #ifdef DEBUG
@@ -485,11 +491,26 @@
   UberButton->BHeight=1;
   MakeContainer(UberButton);
 
+  dpw = DisplayWidth(Dpy,screen);
+  dph = DisplayHeight(Dpy,screen);
+
 # ifdef DEBUG_INIT
   fprintf(stderr,"%s: Parsing...",MyName);
 # endif
 
+  CurrentPanel = MainPanel
+               = (panel_info *) mymalloc(sizeof(panel_info));
+  MainPanel->next = NULL;
+  MainPanel->uber = UberButton;
+  UberButton->title   = MyName;
+  UberButton->swallow = 1; /* the panel is shown */
+
   ParseOptions(UberButton);
+
+  CurrentPanel = MainPanel; /* reassign CurrentPanel */
+  while (CurrentPanel)
+  { UberButton = CurrentPanel->uber;
+
   if(UberButton->c->num_buttons==0)
     {
       fprintf(stderr,"%s: No buttons defined. Quitting\n", MyName);
@@ -518,6 +539,10 @@
 
   CreateWindow(UberButton,maxx,maxy);
 
+    CurrentPanel->uber->IconWinParent = MyWindow;
+    CurrentPanel->uber->icon_w = maxx;
+    CurrentPanel->uber->icon_h = maxy;
+
 # ifdef DEBUG_INIT
   fprintf(stderr,"OK\n%s: Creating icon windows...",MyName);
 # endif
@@ -548,6 +573,13 @@
     SetTransparentBackground(UberButton,Width,Height);
 # endif
 
+    CurrentPanel = CurrentPanel->next;
+  }
+  CurrentPanel = MainPanel;
+  UberButton   = CurrentPanel->uber;
+  MyWindow     = UberButton->IconWinParent;
+
+
 # ifdef DEBUG_INIT
   fprintf(stderr,"OK\n%s: Mapping windows...",MyName);
 # endif
@@ -594,8 +626,16 @@
 	switch(Event.type)
 	  {
 	  case Expose:
-	    if(Event.xany.window==MyWindow)
-	      {
+            PanelIndex = MainPanel;
+            while (PanelIndex && (PanelIndex->uber->IconWinParent != Event.xany.window))
+              PanelIndex = PanelIndex->next;
+            if (PanelIndex)
+            { UberButton = PanelIndex->uber;
+              MyWindow   = UberButton->IconWinParent;
+            }
+            else
+              break;
+
 #ifdef OLD_EXPOSE
 		if(Event.xexpose.count == 0)
 		  {
@@ -644,11 +684,10 @@
 		    ex=ey=10000;ex2=ey2=0;
 		  }
 #endif
-              }
 	    break;
 
 	  case ConfigureNotify:
-	    XGetGeometry(Dpy,MyWindow,&root,&x,&y,
+	    /* XGetGeometry(Dpy, MyWindow, &root, &x, &y,
 			 (ushort*)&tw,(ushort*)&th,
 			 (ushort*)&border_width,(ushort*)&depth);
 	    if(tw!=Width || th!=Height)
@@ -660,7 +699,7 @@
 		while(NextButton(&ub,&b,&button,0))
 		  MakeButton(b);
                 RedrawWindow(NULL);
-	      }
+	      } */ /* I don't like to change its size after it started */
 	    break;
 
 	  case KeyPress:
@@ -668,30 +707,68 @@
 	    if(keysym!=XK_Return && keysym!=XK_KP_Enter && keysym!=XK_Linefeed)
 	      break;	                /* fall through to ButtonPress */
 	  case ButtonPress:
+            PanelIndex = MainPanel;
+            b = NULL;
+            do
+              if (PanelIndex->uber->swallow)
+              {
+                UberButton = PanelIndex->uber;
+                MyWindow   = UberButton->IconWinParent;
+                if (Event.xany.window == MyWindow)
 	    CurrentButton = b = 
 	      select_button(UberButton,Event.xbutton.x,Event.xbutton.y);
+
+              }
+            while (!b && PanelIndex->next && (PanelIndex = PanelIndex->next));
+
 	    if(!b || !(b->flags&b_Action))
 	      {
 		CurrentButton=NULL;
 		break;
 	      }
+
+            CurrentPanel = PanelIndex; /* record which panel, the button pressed */
+            UberButton = CurrentPanel->uber;
+            MyWindow   = UberButton->IconWinParent;
+
 	    RedrawButton(b,0);
 	    if(!(act=GetButtonAction(b,Event.xbutton.button)))
 	      act=GetButtonAction(b,0);
 	    if(mystrncasecmp(act,"popup",5)!=0)
+	    { if (mystrncasecmp(act, "panel", 5) == 0)
+                Slide(seekpanel(b), b);
 	      break;
+            }
 	    else /* i.e. action is Popup */
 	      XUngrabPointer(Dpy,CurrentTime); /* And fall through */
 
 	  case KeyRelease:
 	  case ButtonRelease:
+            PanelIndex = MainPanel;
+            b = NULL;
+            while (PanelIndex && !b)
+            { if (PanelIndex->uber->swallow)
+              { UberButton = PanelIndex->uber;
+                MyWindow   = UberButton->IconWinParent;
+                if (Event.xany.window == MyWindow)
 	    b=select_button(UberButton,Event.xbutton.x,Event.xbutton.y);
+              }
+              PanelIndex = PanelIndex->next;
+            }
+
 	    if(!(act=GetButtonAction(b,Event.xbutton.button)))
 	      act=GetButtonAction(b,0);
 	    if(b && b==CurrentButton && act)
 	      {
 		if(mystrncasecmp(act,"Exec",4)==0)
 		  {
+                    /* close all subpanels */
+                    PanelIndex = MainPanel->next;
+                    while (PanelIndex)
+                    { if (PanelIndex->uber->swallow) Slide(PanelIndex, NULL);
+                      PanelIndex = PanelIndex->next;
+                    }
+
 		    /* Look for Exec "identifier", in which case the button
 		       stays down until window "identifier" materializes */
 		    i=4;
@@ -728,9 +805,14 @@
 		  DumpButtons(UberButton);
 		else if(mystrncasecmp(act,"SaveButtons",11)==0)
 		  SaveButtons(UberButton);
-		else
+		else if(mystrncasecmp(act,"panel",5))
 		  MySendText(fd,act,0);
 	      }
+
+            /* recover the old record */
+            UberButton = CurrentPanel->uber; /* the panel, the button pressed */
+            MyWindow   = UberButton->IconWinParent;
+
 	    b=CurrentButton;
 	    CurrentButton=NULL;
 	    if(b)
@@ -1041,6 +1123,11 @@
   unsigned long gcm;
   XClassHint myclasshints;
 
+  x = CurrentPanel->uber->x; /* Geometry x where to put the panel */
+  y = CurrentPanel->uber->y; /* Geometry y where to put the panel */
+  xneg = CurrentPanel->uber->w;
+  yneg = CurrentPanel->uber->h;
+
   if(maxx<16)
     maxx=16;
   if(maxy<16)
@@ -1160,13 +1247,15 @@
 # endif
   XSetWMProtocols(Dpy,MyWindow,&_XA_WM_DEL_WIN,1);
 
-  myclasshints.res_name=strdup(MyName);
-  myclasshints.res_class=strdup("FvwmButtons");
+  myclasshints.res_name=strdup((CurrentPanel == MainPanel)
+                                 ? MyName : CurrentPanel->uber->title);
+  myclasshints.res_class=strdup((CurrentPanel == MainPanel)
+                                 ? "FvwmButtons" : "FvwmButtonsPanel");
 
   {
     XTextProperty mynametext;
     char *list[]={NULL,NULL};
-    list[0]=MyName;
+    list[0]=(CurrentPanel == MainPanel) ? MyName : CurrentPanel->uber->title;
     if(!XStringListToTextProperty(list,1,&mynametext))
       {
 	fprintf(stderr,"%s: Failed to convert name to XText\n",MyName);
@@ -1652,3 +1741,114 @@
       }
 }
 
+/*
+ * Button
+ *   b->flags     |= b_Action (though b->hangon is ilegally used)
+ *   b->action[0]  = "panel-h" or "panel-v"
+ *   b->hangon     = panel title (case sensitive)
+ * Panel
+ *   uber->flags  |= b_Container (though the following fields are ilegally used)
+ *   uber->title   = the title of the panel
+ *   uber->IconWinParent = the panel window, will be assigned to MyWindow
+ *   uber->swallow = 0:hidden 1:shown
+ *   uber->icon_w  = panel width
+ *   uber->icon_h  = panel height
+ *   uber->x       = x position to start the panel wrt the button b
+ *   uber->y       = y position to start the panel wrt the button b
+ *   uber->w       = xneg
+ *   uber->h       = yneg
+ *   CurrentPanel  = the panel where the button b was pressed to popup a new panel
+ */
+
+#define PanelPopUpStep 32
+
+panel_info *seekpanel (button_info *b)
+{
+  panel_info *PanelIndex = MainPanel->next; /* skip the main panel */
+
+  while (PanelIndex && strcmp(b->hangon, PanelIndex->uber->title))
+    PanelIndex = PanelIndex->next;
+  
+  return PanelIndex;
+}
+
+void Slide (panel_info *p, button_info *b)
+{
+  Window PanelWin;
+  Window root;
+  int x, y, iw, ih, BW, depth;
+
+  if (!p) return;                            /* no such panel */
+  else    PanelWin = p->uber->IconWinParent; /* PanelWin is found */
+
+  if (p->uber->swallow)
+  { /* shown ---> hidden */
+    root = GetRealGeometry(Dpy, PanelWin, &x, &y,
+                           (ushort*)&iw, (ushort*)&ih,
+                           (ushort*)&BW, (ushort*)&depth);
+
+    if (b && b->action[0][6] == 'h')
+      while (PanelPopUpStep < iw)  /* horizontal */
+      { iw -= PanelPopUpStep;
+        x  += PanelPopUpStep;
+        XMoveResizeWindow(Dpy, PanelWin, x, y, iw, ih);
+      }
+    else
+      while (PanelPopUpStep < ih)  /* vertical */
+      { ih -= PanelPopUpStep;
+        y  += PanelPopUpStep;
+        XMoveResizeWindow(Dpy, PanelWin, x, y, iw, ih);
+      }
+
+    XUnmapWindow(Dpy, PanelWin);
+    p->uber->swallow = 0;
+  } 
+  else
+  { /* hidden ---> shown */
+    int ix = buttonXPos(b, b->n);  /* button in the CurrentPanel */
+    int iy = buttonYPos(b, b->n);  /* button in the CurrentPanel */
+
+    int mw = p->uber->icon_w; /* panel menu width */
+    int mh = p->uber->icon_h; /* panel menu height */
+    int w;                    /* current width */
+    int h;                    /* current height */
+
+    root = GetRealGeometry(Dpy, CurrentPanel->uber->IconWinParent, &x, &y,
+                           (ushort*)&iw, (ushort*)&ih,
+                           (ushort*)&BW, (ushort*)&depth);
+
+    x += p->uber->x + ix;
+    y += p->uber->y + iy;
+
+    /* initial position and size */
+    if (b->action[0][6] == 'h')
+    { w = mw % PanelPopUpStep;      /* horizontal */
+      if (w == 0) w = PanelPopUpStep;
+      x -= w;
+      XMoveResizeWindow(Dpy, PanelWin, x, y, w, mh);
+    }
+    else
+    { h = mh % PanelPopUpStep;      /* vertical */
+      if (h == 0) h = PanelPopUpStep;
+      y -= h;
+      XMoveResizeWindow(Dpy, PanelWin, x, y, mw, h);
+    }
+ 
+    XMapSubwindows(Dpy, PanelWin);
+    XMapWindow(Dpy, PanelWin);
+
+    if (b->action[0][6] == 'h')
+      while (w < mw)            /* horizontal */
+      { x -= PanelPopUpStep;
+        w += PanelPopUpStep;
+        XMoveResizeWindow(Dpy, PanelWin, x, y, w, mh);
+      }
+    else
+      while (h < mh)            /* vertical */
+      { y -= PanelPopUpStep;
+        h += PanelPopUpStep;
+        XMoveResizeWindow(Dpy, PanelWin, x, y, mw, h);
+      }
+    p->uber->swallow = 1;
+  }
+}
diff -u -b -B old/fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.h fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.h
--- old/fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.h	Thu Jun 26 16:32:32 1997
+++ fvwm-2.0.46/modules/FvwmButtons/FvwmButtons.h	Mon Feb  2 22:19:39 1998
@@ -69,6 +69,7 @@
 #define b_TitleHoriz  0x03 /* Mask for title x positioning info */
 #define b_Horizontal  0x04 /* HACK: stack title and iconwin horizontally */
 
+typedef struct panel_info_struct panel_info;
 typedef struct button_info_struct button_info;
 typedef struct container_info_struct container_info;
 #define ushort unsigned int
@@ -143,6 +144,11 @@
   ushort w,h,bw;           /* b_Swallow */
 };
 
+struct panel_info_struct
+{ button_info  *uber;      /* panel */
+  panel_info   *next;
+};
+
 #include "button.h"
 
 /* -------------------------------- other macros --------------------------- */
@@ -173,6 +179,7 @@
 extern Window MyWindow;
 extern char *MyName;
 extern button_info *UberButton,*CurrentButton;
+extern panel_info *MainPanel, *CurrentPanel;
 
 extern char *iconPath;
 extern char *pixmapPath;
Only in fvwm-2.0.46/modules/FvwmButtons: Makefile
diff -u -b -B old/fvwm-2.0.46/modules/FvwmButtons/parse.c fvwm-2.0.46/modules/FvwmButtons/parse.c
--- old/fvwm-2.0.46/modules/FvwmButtons/parse.c	Thu Jun 26 16:32:33 1997
+++ fvwm-2.0.46/modules/FvwmButtons/parse.c	Wed Feb 11 23:05:38 1998
@@ -28,7 +28,7 @@
 #include "FvwmButtons.h"
 #include "button.h"
 
-extern int w,h,x,y,xneg,yneg;
+extern int w,h,x,y,xneg,yneg; /* used in ParseConfigLine */ 
 extern char *config_file;
 
 /* ----------------------------------- macros ------------------------------ */
@@ -400,6 +400,7 @@
     {
       char *opts[]={"back","fore","font","title","icon","frame","padding",
 		      "swallow","action","container","end","nosize","size",
+                      "panel",
 		      NULL};
       trimleft(s);
       while(*s && *s!=')')
@@ -620,6 +621,42 @@
 		fprintf(stderr,"%s: Illegal size arguments\n",MyName);
 	      break;
 
+	      /* --------------------------- panel ------------------------ */
+	     
+	    case 13: /* Panel */
+	      trimleft(s);
+	      i=0;
+	      if(*s=='(')
+		{
+		  s++;
+		  i=strtol(s,&t,10);
+		  s=t;
+		  while(*s && *s!=')') 
+		    s++;
+		  if(*s==')')s++;
+		}
+              if (i == 1)
+              { /* horizontal */
+                AddButtonAction(b,0,strdup("panel-h"));
+                if ((~b->flags)&(b_Title | b_Icon))
+		{ b->icon_file = strdup("arrow_left.xpm");
+		  b->IconWin   = None;
+		  b->flags    |= b_Icon;
+                }
+              }
+	      else
+              { /* vertical */
+                AddButtonAction(b,0,strdup("panel-v"));
+                if ((~b->flags)&(b_Title | b_Icon))
+		{ b->icon_file = strdup("arrow_up.xpm");
+		  b->IconWin   = None;
+		  b->flags    |= b_Icon;
+                }
+              }
+	      t = seekright(&s);
+              b->hangon = strdup(t);  /* which panel to popup */
+	      break;
+
 	    default:
 	      t=seekright(&s);
 	      fprintf(stderr,"%s: Illegal button option \"%s\"\n",MyName,t);
@@ -695,7 +732,7 @@
 {
   button_info *ub=*ubb;
   char *opts[]={"geometry","font","padding","columns","rows","back","fore",
-		  "frame","file","pixmap",NULL};
+		  "frame","file","pixmap","panel",NULL};
   int i,j,k;
 
   switch(MatchSeveralLines(s,opts,&s))
@@ -711,10 +748,10 @@
 	    flags=XParseGeometry(geom,&g_x,&g_y,&width,&height);
 	    if(flags&WidthValue) w=width;
 	    if(flags&HeightValue) h=height;
-	    if(flags&XValue) x=g_x;
-	    if(flags&YValue) y=g_y;
-	    if(flags&XNegative) xneg=1;
-	    if(flags&YNegative) yneg=1;
+	    if(flags&XValue)    UberButton->x = g_x;
+	    if(flags&YValue)    UberButton->y = g_y;
+	    if(flags&XNegative) UberButton->w = 1;
+	    if(flags&YNegative) UberButton->h = 1;
 	  }
 	break;
       }
@@ -755,6 +792,22 @@
       else
         CopyString(&(ub->c->back_file),s);
       ub->c->flags|=b_IconBack;
+      break;
+    case 10:/* Panel */
+      trimleft(s);
+      CurrentPanel->next = (panel_info *) mymalloc(sizeof(panel_info));
+      CurrentPanel = CurrentPanel->next;
+      CurrentPanel->next = NULL;
+      CurrentPanel->uber = UberButton
+                         = (button_info *) mymalloc(sizeof(button_info));
+      UberButton->title = seekright(&s);
+      UberButton->flags = 0;
+      UberButton->parent = NULL;
+      UberButton->BWidth = 1;
+      UberButton->BHeight = 1;
+      UberButton->swallow = 0; /* subpanel is hidden initially */
+      MakeContainer(UberButton);
+      *ubb = UberButton;
       break;
     default:
       trimleft(s);

--------------61E85DBC3C3678333C1DCA9--

--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Wed Feb 11 23:31:51 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Wed, 11 Feb 1998 23:31:51 -0600 (CST)
Received: from mail1.doit.wisc.edu (mail1.doit.wisc.edu [144.92.9.40]) by sina.hpc.uh.edu (8.7.3/8.7.3) with ESMTP id XAA25364 for <fvwm-workers@hpc.uh.edu>; Wed, 11 Feb 1998 23:31:44 -0600 (CST)
Received: from [144.92.12.117] by mail1.doit.wisc.edu
          id XAA69718 (8.8.6/50); Wed, 11 Feb 1998 23:31:39 -0600
Message-ID: <34E288E7.646F5DAE@percy.wisc.edu>
Date: Wed, 11 Feb 1998 23:30:15 -0600
From: Jui-Hsuan Joshua Feng <fengj@percy.wisc.edu>
X-Mailer: Mozilla 3.04Gold (X11; I; Linux 2.0.30 i586)
MIME-Version: 1.0
To: fvwm-workers@hpc.uh.edu
CC: fengj@percy.engr.wisc.edu
Subject: Sample fvwm2rc: animated menu + autohide
Content-Type: multipart/mixed; boundary="------------13C9BCF6274771C71A0A4F46"
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

This is a multi-part message in MIME format.

--------------13C9BCF6274771C71A0A4F46
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

Hi,

Hope this useful to understand the syntax of animated menu/panel
and autohide

-- 
Jui-Hsuan Joshua Feng                         (O)608/262-3640 
Electrical & Computer Engr, University of Wisconsin - Madison    
http://www.cae.wisc.edu/~fengj           fengj@percy.wisc.edu

--------------13C9BCF6274771C71A0A4F46
Content-Type: text/plain; charset=us-ascii; name="system.fvwm2rc"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline; filename="system.fvwm2rc"

# be sure to customize these paths for your installation:
ModulePath /usr/lib/X11/fvwm2
PixmapPath /usr/include/X11/pixmaps
IconPath   /usr/include/X11/bitmaps


Style "Fvwm*"       NoTitle, Sticky, BorderWidth 2, WindowListSkip
Style "Fvwm*"       CirculateSkipIcon, CirculateSkip

AddToDecor Button-decor
+ HilightColor white steelblue

Style "FvwmButtons" UseDecor Button-decor, WindowListSkip, StaysOnTop
Style "FvwmButtons" NoHandles, BorderWidth 3, FvwmBorder
Style "FvwmButtons" Icon toolbox.xpm

Style "FvwmButtonsPanel" UseDecor Button-decor, Title, NoHandles, BorderWidth 0
Style "FvwmButtonsPanel" NoButton 2, NoButton 4

# When move the windows, the value 'XORed' to the edge -1 = "ffffff"
XORvalue -1

##################### FvwmButtons button-bar ##################################
*FvwmButtonsAutoHide 1
*FvwmButtonsBack bisque2
#*FvwmButtonsBack LightSteelBlue3
#*FvwmButtonsBack Grey
*FvwmButtonsGeometry +0-0
*FvwmButtonsRows 1

*FvwmButtons(2x1 Frame 0 Padding 0 0 Container(Rows 4 Frame -2 Padding 0 0))

  *FvwmButtons(10x1 Frame 0 Padding 0 0 Container(Rows 1 Frame -2 Padding 0 0))
    *FvwmButtons(1x1 Nosize Frame 1 Icon mini.resize.xpm, Action 'Move')
    *FvwmButtons(1x1 Nosize Frame 1 Icon mini-bomb.xpm, Action Close) 
    *FvwmButtons(2x1 Frame 1 Title EXIT, Action 'Module FvwmForm QuitVerify')
    *FvwmButtons(2x1 Nosize Frame 1 Icon mini-mail.xpm, Action 'MailFunction xmh "-font fixed"')
    *FvwmButtons(2x1 Nosize Frame 1 Panel 'Applications')
    *FvwmButtons(2x1 Nosize Frame 1 Panel 'Utilities')
  *FvwmButtons(End)

  *FvwmButtons(2x3 Frame 0 Padding 3 Swallow(Respawn, UseOld) XClock \
               'Exec /usr/bin/X11/xclock -bg bisque3 -padding 1 -geometry +5+5')

  *FvwmButtons(2x3 Frame 0 Padding 0 Icon CDE/graphics_pix.xpm)
  #*FvwmButtons(2x3 Frame 0 Padding 3 Swallow(Respawn, NoHints) xload \
  #             'Exec /usr/bin/X11/xload -scale 3 -nolabel -fg Black -bg DarkGrey')

  *FvwmButtons(2x3 Frame 0 Padding 3 Swallow(Respawn, UseOld) xbiff \
             'Exec xbiff -fg Black -geometry +50+10 -bg LightCyan3')

  *FvwmButtons(2x3 Frame 0 Padding 3 Icon apps_pix.xpm)

  *FvwmButtons(2x3 Frame 0 Padding 0 0 Container(Columns 2 Frame -2 Padding 0 0))
    *FvwmButtons(1x1 Nosize Frame 1 Icon mini.xterm.xpm, Action 'Exec rxvt -bg Black -fg White -sb -ls')
    *FvwmButtons(1x1 Nosize Frame 1 Icon mini-term.xpm, Action 'Exec /usr/bin/X11/crxvt -font vga8x15 -fnb5 et15 -ls &')
    *FvwmButtons(2x1 Nosize Frame 1 Icon mini-lock.xpm, Action 'Exec xlock -bg Black -fg White')
    *FvwmButtons(1x1 Nosize Frame 1 Icon mini-zoom.xpm, Action 'Exec xmag') 
    *FvwmButtons(1x1 Nosize Frame 1 Icon mini-calc.xpm, Action 'Exec xcalc')
  *FvwmButtons(End)

*FvwmButtons(End)

*FvwmButtons(Frame 1 Padding 0 Swallow(Respawn, UseOld, Kill, NoHints) \
             FvwmPager 'Module FvwmPager 0 1')

####### PANEL 
*FvwmButtonsPanel Applications
*FvwmButtonsBack bisque2
#*FvwmButtonsBack Grey
*FvwmButtonsGeometry -16-3
*FvwmButtonsColumns 1

*FvwmButtons(1x2 Frame 1 Title(Left Side) Acrobat Icon acrobat.xpm, Action 'Exec /usr/local/lib/Acrobat3/bin/acroread')
*FvwmButtons(1x1 Frame 1 Title(Left Side) GV Icon mini-gv.xpm, Action 'Exec gv -letter')
*FvwmButtons(1x3 Frame 1 Title(Left Side) Gimp Icon gimp.xpm, Action 'Exec /usr/local/bin/gimp')
*FvwmButtons(1x1 Frame 1 Title(Left Side) Netscape Icon mini.netscape.xpm, Action  'Exec /usr/local/bin/netscape &')
*FvwmButtons(1x2 Frame 1 Title(Left Side) Scilab Icon scilab.xpm, Action 'Exec /usr/bin/scilab')
*FvwmButtons(1x1 Frame 1 Title(Left Side) VRweb, Action 'Exec /usr/local/bin/vrweb -helpDir /usr/local/lib/vrweb/help')
*FvwmButtons(1x2 Frame 1 Title(Left Side) XV Icon xv.xpm, Action 'Exec xv')
*FvwmButtons(1x1 Frame 1 Title(Left Side) Xpaint Icon mini.xpaint.xpm, Action 'Exec xpaint')

####### PANEL 
*FvwmButtonsPanel Utilities
*FvwmButtonsBack bisque2
#*FvwmButtonsBack Grey
*FvwmButtonsGeometry -16-3
*FvwmButtonsColumns 1

*FvwmButtons(1x1 Frame 1 Title(Left Side) Workman, Action 'Exec /usr/bin/X11/workman')
*FvwmButtons(1x1 Frame 1 Title(Left Side) Vim, Icon mini-edit.xpm, Action 'Exec /usr/bin/gvim') 
*FvwmButtons(1x2 Frame 1 Title(Left Side) Monitor, Icon CDE/monitor.xpm)
*FvwmButtons(1x2 Frame 1 Title(Left Side) Books, Icon CDE/books_pix.xpm)
*FvwmButtons(1x2 Frame 1 Title(Left Side) Files, Icon CDE/files_pix.xpm)
*FvwmButtons(1x2 Frame 1 Title(Left Side) Edit, Icon CDE/edit_pix.xpm)
*FvwmButtons(1x2 Frame 1 Title(Left Side) Application, Icon apps_pix.xpm)
*FvwmButtons(1x2 Frame 1 Title(Left Side) Printer, Icon CDE/printer_pix.xpm)
*FvwmButtons(1x2 Frame 1 Title(Left Side) Recycle, Icon CDE/trash_pix.xpm)

--------------13C9BCF6274771C71A0A4F46--

--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Sat Feb 14 15:19:23 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Sat, 14 Feb 1998 15:19:23 -0600 (CST)
Received: from hibernia.res.cmu.edu (HIBERNIA.RES.CMU.EDU [128.2.74.92]) by sina.hpc.uh.edu (8.7.3/8.7.3) with SMTP id PAA02070 for <fvwm-workers@hpc.uh.edu>; Sat, 14 Feb 1998 15:19:16 -0600 (CST)
Received: from cmu.edu (HIBERNIA.RES.CMU.EDU [128.2.74.92]) by hibernia.res.cmu.edu (950413.SGI.8.6.12/950213.SGI.AUTOCF) via ESMTP id QAA00156 for <fvwm-workers@hpc.uh.edu>; Sat, 14 Feb 1998 16:15:51 -0500
Message-ID: <34E60987.17CD4F2A@cmu.edu>
Date: Sat, 14 Feb 1998 16:15:51 -0500
From: Sean Cier <scier@cmu.edu>
Organization: Carnegie Mellon University
X-Mailer: Mozilla 4.04 [en] (X11; I; IRIX 6.3 IP32)
MIME-Version: 1.0
To: fvwm-workers@hpc.uh.edu
Subject: Bug fix for FvwmWinList
Content-Type: multipart/mixed; boundary="------------45F2962A5BE0C0DF16C8D29B"
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

This is a multi-part message in MIME format.
--------------45F2962A5BE0C0DF16C8D29B
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

I'm not on this list, but I thought I'd report a bug I just hacked out
of FvwmWinList (the 'creeping by one pixel' bug) that I'd seen
mentioned.  If it's already been fixed properly or hacked out, my
apologies.  I didn't look at the code closely enough to see if this is
entirely correct, but it seems to work for now.  Patch attached.

-spc

-- 
 /-                    Sean Cier <scier@cmu.edu>                    -\
(                Dreams of falling, dreams of flying;                 )
(               a man who never dreams goes slowly mad                )
 \-                http://www.andrew.cmu.edu/~scier                 -/
--------------45F2962A5BE0C0DF16C8D29B
Content-Type: text/plain; charset=us-ascii; name="FvwmWinList-scier-021498-0.patch"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline; filename="FvwmWinList-scier-021498-0.patch"

--- ../FvwmWinList/FvwmWinList.c	Sat Feb 14 16:13:34 1998
+++ FvwmWinList.c	Sat Feb 14 16:13:22 1998
@@ -731,6 +731,8 @@
 	else	
 		win_y-=win_border;
       }
+      win_x++;
+      win_y++;
 
       XMoveResizeWindow(dpy,win,win_x+win_border,win_y+win_title+win_border,
         new_width,new_height);

--------------45F2962A5BE0C0DF16C8D29B--

--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Sun Feb 22 07:39:08 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Sun, 22 Feb 1998 07:39:08 -0600 (CST)
Received: from nether.tky.hut.fi (nether.tky.hut.fi [130.233.23.85]) by sina.hpc.uh.edu (8.7.3/8.7.3) with ESMTP id HAA28695 for <fvwm-workers@hpc.uh.edu>; Sun, 22 Feb 1998 07:38:59 -0600 (CST)
Received: from iki.fi (ts@hidden [192.168.1.224])
	by nether.tky.hut.fi (8.8.7/8.8.5) with ESMTP id PAA00059
	for <fvwm-workers@hpc.uh.edu>; Sun, 22 Feb 1998 15:41:54 +0200
Message-ID: <34F046A9.961EB638@iki.fi>
Date: Sun, 22 Feb 1998 17:39:21 +0200
From: Tomi Sarvela <tomi.sarvela@iki.fi>
X-Mailer: Mozilla 4.04 [en] (X11; U; Linux 2.0.33 i586)
MIME-Version: 1.0
To: fvwm-workers@hpc.uh.edu
Subject: Hi! Couple of quickies ...
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

First, I must admit I'm new at fvwm, but it seemed that it does the
best what I want from windowmanager. Thank you for that.

There's been some oddities though (or should I call them features? ;)

The pixmap doesn't seem to update right to the titlebar. I have
pixmap in TitleStyle ActiveUp and InActive, but the pixmap doesn't
show up in any position. If I put it into ActiveDown, too, it shows
up right in other positions. I use ClickToFocus, if that affects
anything.

When the pixmap is in the titlebar, it is under the title, too, but
that's probably a configuring problem for me, as I've seen snapshots
with the pixmap not being under the titletext.

The 'Raised' and 'Sunken' seems to have switched meanings in TitleStyle
definitions (maybe in other Styles, too?) If TitleStyle ActiveUp and
InActive are Flat and ActiveDown Raised, it appears Sunken. Could be
related to the feature above.

I have also thought a possibility to have no pixmap in the iconified
windows: only the title (the opposite of NOICON_TITLE). It could be
done (without adding styles) with SUPPRESSICON, changing it's meaning
to NOICON_PIXMAP, and doing the equal of SUPPRESSICON by using
NOICON_TITLE & NOICON_PIXMAP. That would change only a few lines in
the code, but I can't say about the further effects.

The reason for above? You could have the equivalent of windowlist
(the iconified windows only) in the corner of the screen. Now, if I
could just imagine how to stick the icons to their default places,
so that they couldn't be dragged around, and force the icons (or
icontitles only) to use forced size ... (yes, I think AfterStep
style is nice and clean, but not configurable enough)

I'd like to hear comments why this is or isn't easy or smart to do ...
Bear with me and all the best,

Tomi

tomi.sarvela@iki.fi
Ideas and thoughts expressed herein are mine, all mine!
--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Wed Feb 25 18:09:04 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Wed, 25 Feb 1998 18:09:04 -0600 (CST)
Received: from alphatech.com (erebus.alphatech.com [198.112.236.2]) by sina.hpc.uh.edu (8.7.3/8.7.3) with SMTP id SAA11235; Wed, 25 Feb 1998 18:08:56 -0600 (CST)
Received: from venus.alphatech.com by alphatech.com (SMI-8.6/SMI-SVR4)
	id TAA11148; Wed, 25 Feb 1998 19:08:08 -0500
Received: from pochacco.alphatech.com by venus.alphatech.com (4.1/SMI-4.1)
	id AA04533; Wed, 25 Feb 98 19:08:46 EST
Received: by pochacco.alphatech.com (SMI-8.6/SMI-SVR4)
	id TAA12491; Wed, 25 Feb 1998 19:03:02 -0500
Message-Id: <199802260003.TAA12491@pochacco.alphatech.com>
Mime-Version: 1.0
Date: Wed, 25 Feb 1998 19:03:01 -0500 (EST)
From: greg@alphatech.com (Greg Klanderman)
To: fvwm@hpc.uh.edu, fvwm-workers@hpc.uh.edu
Subject: sticky windows and changing desks
Reply-To: greg@alphatech.com
Content-Type: text/plain; charset=US-ASCII
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7



When focus-follows-mouse is set and you're focused on a sticky window, 
changing desks results in no window having the focus, even though the
sticky window remains under the mouse.

The code in fvwm/virtual.c (function changeDesks) has a bit of code
commented out which as far as I can tell does the right thing.  There
is a cryptic comment indicating that it doesn't work.  If someone
could explain it I would greatly appreciate it.  The only thing I can
guess is that it might be buggy due to the variable StickyWin being
static in the function.  I uncommented the code and made StickyWin
non-static and it all seems to work right.  I can't see any problem
with sticky click-to-focus windows.  Am I missing something?

thank you for your time,
Greg

ps - Could you please include me directly in followups.  
     I am not on either list.  

Also, I sent a few patches last November and December and have not
heard anything.  Would it be possible to get some feedback as to
whether these have been accepted?

Finally, on your TODO list on the web you mention you'd like FvwmAuto
to be customizable on a per- window-{name,class..} basis.  I've got a
fvwmperl module that does this - its rather general.  If you'd like to 
include it I'd be happy to let you have it.



--- ../../.backups/virtual.c!!!proj!mstar!software!fvwm!fvwm-2.0.46!fvwm!.~1~	Thu Aug 14 16:21:17 1997
+++ virtual.c	Wed Feb 25 18:23:49 1998
@@ -442,7 +442,8 @@
 {
   int oldDesk;
   FvwmWindow *FocusWin = 0, *t;
-  static FvwmWindow *StickyWin = 0;
+  /* static below seems wrong.. -gk */
+  /* static */ FvwmWindow *StickyWin = 0;
 
   oldDesk = Scr.CurrentDesk;
 
@@ -514,8 +515,10 @@
    * focus-follows-mouse person, but put in one sticky click-to-focus window
    * (typically because you don't really want to give focus to this window),
    * then the following lines are screwed up. */
-/*  else if (StickyWin && (StickyWin->flags && STICKY))
-    SetFocus(StickyWin->w, StickyWin,1);*/
+
+  /* Uncommented next 2 lines - this seems totally reasonable... -gk */
+  else if (StickyWin && (StickyWin->flags && STICKY))
+    SetFocus(StickyWin->w, StickyWin,1);
   else
 #endif
     SetFocus(Scr.NoFocusWin,NULL,1);
--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

From owner-fvwm-workers@hpc.uh.edu  Thu Feb 26 17:27:42 1998
Received: by sina.hpc.uh.edu (TLB v0.09a (1.20 tibbs 1996/10/09 22:03:07)); Thu, 26 Feb 1998 17:27:42 -0600 (CST)
Received: from tekla.ing.umu.se (stric@tekla.ing.umu.se [130.239.117.80]) by sina.hpc.uh.edu (8.7.3/8.7.3) with ESMTP id RAA01083; Thu, 26 Feb 1998 17:19:10 -0600 (CST)
Received: (from stric@localhost)
	by tekla.ing.umu.se (8.8.5/8.8.5) id AAA03988;
	Fri, 27 Feb 1998 00:19:02 +0100
Message-ID: <19980227001902.49764@tekla>
Date: Fri, 27 Feb 1998 00:19:02 +0100
From: Tomas Ogren <stric@ing.umu.se>
To: fvwm@hpc.uh.edu
Cc: fvwm-workers@hpc.uh.edu
Subject: Bug in TitleStyle (?)
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
X-Mailer: Mutt 0.88
X-System: Linux tekla 2.0.33 
X-Until2000: 1 year, 10 months, 3 days, 23 hours, 48 minutes, and 17 seconds
Sender: owner-fvwm-workers@hpc.uh.edu
Precedence: list
X-Majordomo: 1.94.jlt7

The following lines triggers a bug... (fvwm2.0.26, Sol26)

TitleStyle LeftJustified Height 14 (Pixmap ram_l1.xpm) -- Left flat
AddTitleStyle (Pixmap ram_r1.xpm) -- Right

After the first TitleStyle, I get the 'ram_l1.xpm' on the far left side,
but after the AddTitleStyle, the 'ram_l1.xpm' moves to the far right and
the 'ram_r1.xpm' moves to the center of the titlebar.

Any 'AddTitleStyle (Pixmap something.xpm) -- Right' (or Left) pastes
that pixmap in the center of the titlebar.

Anyone have time to look into it?

PS. Don't know if all bug-hunters are on the normal fvwm-list, cc:ing to
fvwm-workers too.. Sorry for any double-mails received... DS.

/Tomas
-- 
,oOo--------------------------------------------  - -
| Tomas gren, stric@ing.umu.se, http://www.ing.umu.se/~stric/
| o Student of Computer Engineering at the University of Ume
| o Sysadmin at ing.umu.se
`o------------------------------- - -  -
--
Visit the official FVWM web page at <URL:http://www.hpc.uh.edu/fvwm/>.
To unsubscribe from the list, send "unsubscribe fvwm-workers" in the
body of a message to majordomo@hpc.uh.edu.
To report problems, send mail to fvwm-workers-owner@hpc.uh.edu.

